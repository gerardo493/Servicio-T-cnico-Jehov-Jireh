{% extends "base.html" %}

{% block content %}
<style>
    .config-container {
        background: linear-gradient(135deg, #f0f0f3 0%, #e6e6e9 100%);
        min-height: 100vh;
        padding: 2rem 0;
    }

    .neo-card-config {
        background: #f0f0f3;
        border-radius: 25px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 20px 20px 60px #d1d9e6, -20px -20px 60px #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s;
    }

    .neo-card-config:hover {
        transform: translateY(-2px);
        box-shadow: 25px 25px 70px #c4c4c7, -25px -25px 70px #ffffff;
    }

    .config-header {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        color: white;
        box-shadow: 20px 20px 60px #c4c4c4, -20px -20px 60px #ffffff;
    }

    .config-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        overflow-x: auto;
        padding: 0.5rem 0;
        max-height: 400px;
        overflow-y: auto;
    }

    .config-tab {
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        background: linear-gradient(135deg, #e8e8e8 0%, #d1d1d1 100%);
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
        font-weight: 600;
        color: #4a5568;
        font-size: 0.9rem;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        position: relative;
    }

    .config-tab:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
    }

    .config-tab.active {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        border-color: #4f46e5;
    }

    .config-tab-content {
        display: none;
    }

    .config-tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .neo-form-group {
        margin-bottom: 1.5rem;
        position: relative;
    }

    .neo-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #2d3748;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .neo-input, select.neo-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        background: #f0f0f3;
        transition: all 0.3s;
        font-size: 0.95rem;
    }

    .neo-input:focus, select.neo-input:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        background: #ffffff;
    }

    .neo-checkbox {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        padding: 0.75rem;
        margin-bottom: 1rem;
        border-radius: 10px;
        transition: all 0.3s;
        background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
    }

    .neo-checkbox:hover {
        background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
        transform: translateX(5px);
    }

    .neo-checkbox input[type="checkbox"] {
        width: 22px;
        height: 22px;
        cursor: pointer;
        accent-color: #4f46e5;
    }

    .btn-save {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        padding: 1rem 2.5rem;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 5px 5px 15px rgba(16, 185, 129, 0.3);
        font-size: 1.1rem;
    }

    .btn-save:hover {
        transform: translateY(-3px);
        box-shadow: 8px 8px 20px rgba(16, 185, 129, 0.5);
    }

    .btn-save:active {
        transform: translateY(0);
    }

    .btn-save.saving {
        opacity: 0.7;
        cursor: not-allowed;
    }

    .alert-success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        display: none;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .section-icon {
        font-size: 1.2rem;
        color: #4f46e5;
    }

    .help-text {
        font-size: 0.85rem;
        color: #666;
        margin-top: 0.25rem;
        font-style: italic;
    }

    .config-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: rgba(79, 70, 229, 0.1);
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
        color: #4f46e5;
        margin-left: 0.5rem;
    }

    .search-tabs {
        margin-bottom: 1rem;
    }

    .search-tabs input {
        border-radius: 20px;
        padding: 0.75rem 1.5rem;
    }

    .tab-counter {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #ef4444;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        font-weight: bold;
    }

    .highlight {
        background: #fef3c7 !important;
        animation: highlight 0.5s ease;
    }

    @keyframes highlight {
        0%, 100% { background: #fef3c7; }
        50% { background: #fde68a; }
    }
</style>

<div class="config-container">
    <div class="container-fluid">
        <div class="config-header">
            <h1><i class="fas fa-cog me-3"></i>Configuración del Sistema</h1>
            <p class="mb-3">Administra todas las configuraciones del sistema</p>
            <div class="search-tabs">
                <input type="text" id="searchTabs" class="form-control neo-input" placeholder="🔍 Buscar sección de configuración..." 
                       onkeyup="filtrarTabs(this.value)">
            </div>
        </div>

        <div class="alert alert-success d-none" id="successAlert" role="alert" style="margin-top: 1rem; padding: 1.5rem; border-radius: 15px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-size: 1.1rem; font-weight: 600; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);">
            <i class="fas fa-check-circle me-2"></i><strong>¡Configuración guardada exitosamente!</strong>
        </div>

        <form method="POST" action="/configuracion" enctype="multipart/form-data">
            <div class="config-tabs">
                <div class="config-tab active" onclick="mostrarTab('empresa')"><i class="fas fa-building"></i> Empresa</div>
                <div class="config-tab" onclick="mostrarTab('tasas')"><i class="fas fa-exchange-alt"></i> Tasas</div>
                <div class="config-tab" onclick="mostrarTab('notificaciones')"><i class="fas fa-bell"></i> Notificaciones</div>
                <div class="config-tab" onclick="mostrarTab('alertas')"><i class="fas fa-exclamation-triangle"></i> Alertas</div>
                <div class="config-tab" onclick="mostrarTab('impresion')"><i class="fas fa-print"></i> Impresión</div>
                <div class="config-tab" onclick="mostrarTab('estados')"><i class="fas fa-tasks"></i> Estados</div>
                <div class="config-tab" onclick="mostrarTab('pagos')"><i class="fas fa-money-bill-wave"></i> Pagos</div>
                <div class="config-tab" onclick="mostrarTab('categorias')"><i class="fas fa-tags"></i> Categorías</div>
                <div class="config-tab" onclick="mostrarTab('seguridad')"><i class="fas fa-shield-alt"></i> Seguridad</div>
                <div class="config-tab" onclick="mostrarTab('visual')"><i class="fas fa-palette"></i> Visual</div>
                <div class="config-tab" onclick="mostrarTab('inventario')"><i class="fas fa-boxes"></i> Inventario</div>
                <div class="config-tab" onclick="mostrarTab('proveedores')"><i class="fas fa-truck"></i> Proveedores</div>
                <div class="config-tab" onclick="mostrarTab('calendario')"><i class="fas fa-calendar"></i> Calendario</div>
                <div class="config-tab" onclick="mostrarTab('contadores')"><i class="fas fa-hashtag"></i> Contadores</div>
                <div class="config-tab" onclick="mostrarTab('reportes')"><i class="fas fa-chart-bar"></i> Reportes</div>
                <div class="config-tab" onclick="mostrarTab('integraciones')"><i class="fas fa-plug"></i> Integraciones</div>
                <div class="config-tab" onclick="mostrarTab('equipos')"><i class="fas fa-mobile-alt"></i> Equipos Clientes</div>
                <div class="config-tab" onclick="mostrarTab('documentos')"><i class="fas fa-file-alt"></i> Documentos</div>
                <div class="config-tab" onclick="mostrarTab('usuarios')"><i class="fas fa-users"></i> Permisos</div>
                <div class="config-tab" onclick="mostrarTab('backup')"><i class="fas fa-cloud-download-alt"></i> Backup</div>
            </div>

            <!-- EMPRESA -->
            <div id="tab-empresa" class="config-tab-content active">
                <div class="neo-card-config">
                    <h3><i class="fas fa-building me-2"></i>Datos de la Empresa</h3>
                    <p class="text-muted mb-3">Configure la información principal de su empresa que aparecerá en los documentos.</p>
                    
                    <h5 class="mb-3"><i class="fas fa-info-circle section-icon"></i> Información Legal</h5>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-tag"></i> Nombre de la Empresa</label>
                                <input type="text" name="empresa_nombre" class="neo-input" value="{{ config.empresa.nombre }}" 
                                       placeholder="Ej: Reparaciones G-FIVE">
                                <small class="help-text">Este nombre aparecerá en facturas y documentos oficiales</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-id-card"></i> RIF</label>
                                <input type="text" name="empresa_rif" class="neo-input" value="{{ config.empresa.rif }}" 
                                       placeholder="J-12345678-9">
                                <small class="help-text">Registro de Información Fiscal</small>
                            </div>
                        </div>
                    </div>

                    <h5 class="mb-3 mt-4"><i class="fas fa-map-marker-alt section-icon"></i> Ubicación</h5>
                    <div class="neo-form-group">
                        <label class="neo-label"><i class="fas fa-location-dot"></i> Dirección Principal</label>
                        <input type="text" name="empresa_direccion" class="neo-input" value="{{ config.empresa.direccion }}" 
                               placeholder="Av. Principal, Edificio, Piso, Ciudad">
                        <small class="help-text">Dirección completa para documentos oficiales</small>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-city"></i> Ciudad</label>
                                <input type="text" name="empresa_ciudad" class="neo-input" value="{{ config.empresa.get('ciudad', '') }}" 
                                       placeholder="Caracas">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-state"></i> Estado</label>
                                <input type="text" name="empresa_estado" class="neo-input" value="{{ config.empresa.get('estado', '') }}" 
                                       placeholder="Distrito Capital">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-flag"></i> País</label>
                                <input type="text" name="empresa_pais" class="neo-input" value="{{ config.empresa.get('pais', 'Venezuela') }}" 
                                       placeholder="Venezuela">
                            </div>
                        </div>
                    </div>

                    <h5 class="mb-3 mt-4"><i class="fas fa-phone section-icon"></i> Contacto</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-phone-alt"></i> Teléfono Principal</label>
                                <input type="tel" name="empresa_telefono" class="neo-input" value="{{ config.empresa.telefono }}" 
                                       placeholder="+58 212 1234567">
                                <small class="help-text">Número principal de contacto</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-mobile-alt"></i> WhatsApp</label>
                                <input type="tel" name="empresa_whatsapp" class="neo-input" value="{{ config.empresa.get('whatsapp', '') }}" 
                                       placeholder="+58 412 1234567">
                                <small class="help-text">Para notificaciones automáticas</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-at"></i> Email</label>
                                <input type="email" name="empresa_email" class="neo-input" value="{{ config.empresa.email }}" 
                                       placeholder="info@empresa.com">
                            </div>
                        </div>
                    </div>

                    <h5 class="mb-3 mt-4"><i class="fas fa-globe section-icon"></i> Web y Redes</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fas fa-globe"></i> Sitio Web</label>
                                <input type="url" name="empresa_website" class="neo-input" value="{{ config.empresa.website }}" 
                                       placeholder="https://www.empresa.com">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label"><i class="fab fa-instagram"></i> Instagram</label>
                                <input type="text" name="empresa_instagram" class="neo-input" value="{{ config.empresa.get('instagram', '') }}" 
                                       placeholder="@empresa">
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-image section-icon"></i> Logo de la Empresa</h5>
                    <div class="neo-form-group">
                        <label class="neo-label"><i class="fas fa-image"></i> Subir Logo</label>
                        <div class="d-flex align-items-center gap-3 mb-2">
                            <div class="logo-preview-container">
                                {% if config.empresa.get('logo_path') %}
                                <img id="logoPreview" src="/{{ config.empresa.get('logo_path', 'static/logo.png') }}" 
                                     alt="Logo actual" style="max-height: 100px; border-radius: 10px; padding: 10px; background: white;">
                                {% else %}
                                <img id="logoPreview" src="/static/logo.png" alt="Logo actual" 
                                     style="max-height: 100px; border-radius: 10px; padding: 10px; background: white;">
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <input type="file" name="empresa_logo" id="empresa_logo" accept="image/*" class="form-control neo-input" 
                                       onchange="previewLogo(this)">
                                <small class="help-text">Formatos: JPG, PNG, SVG. Tamaño recomendado: 200x200px</small>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="document.getElementById('empresa_logo').value=''; document.getElementById('logoPreview').src='/static/logo.png';">
                            <i class="fas fa-times"></i> Limpiar
                        </button>
                    </div>

                    <h5 class="mb-3 mt-4"><i class="fas fa-info-circle section-icon"></i> Información Adicional</h5>
                    <div class="neo-form-group">
                        <label class="neo-label"><i class="fas fa-info"></i> Descripción o Eslogan</label>
                        <input type="text" name="empresa_descripcion" class="neo-input" value="{{ config.empresa.get('descripcion', '') }}" 
                               placeholder="Tu mejor opción en reparaciones">
                        <small class="help-text">Aparecerá en facturas y documentos</small>
                    </div>
                    
                    <div class="neo-form-group">
                        <label class="neo-label"><i class="fas fa-clock"></i> Horario de Atención</label>
                        <input type="text" name="empresa_horario" class="neo-input" value="{{ config.empresa.get('horario', '') }}" 
                               placeholder="Lun-Vie: 8:00 AM - 6:00 PM">
                    </div>
                </div>
            </div>

            <!-- TASAS -->
            <div id="tab-tasas" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-exchange-alt me-2"></i>Configuración de Tasas de Cambio</h3>
                    <p class="text-muted mb-3">Gestiona las tasas de cambio utilizadas en el sistema para cálculos monetarios.</p>
                    
                    <h5 class="mb-3"><i class="fas fa-sync-alt section-icon"></i> Actualización Automática</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="actualizacion_automatica" id="actualizacion_automatica" {% if config.tasas.actualizacion_automatica %}checked{% endif %}>
                        <label for="actualizacion_automatica">
                            <strong>Actualización Automática desde BCV</strong>
                            <span class="help-text d-block">El sistema obtendrá la tasa oficial del Banco Central de Venezuela automáticamente</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="notificar_cambios" id="notificar_cambios" {% if config.tasas.notificar_cambios %}checked{% endif %}>
                        <label for="notificar_cambios">
                            <strong>Notificar Cambios de Tasa</strong>
                            <span class="help-text d-block">Recibir alertas cuando la tasa cambie significativamente</span>
                        </label>
                    </div>
                    
                    <div class="alert alert-info mb-3" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <div class="row">
                            <div class="col-md-6">
                                <i class="fas fa-dollar-sign"></i> 
                                <strong>Tasa USD Actual:</strong> 
                                <span id="tasaUsdActual">{{ config.tasas.get('tasa_actual_usd', 253.90) }}</span>
                                {% if config.tasas.get('ultima_actualizacion') %}
                                <br><small class="text-muted">Última actualización: {{ config.tasas.get('ultima_actualizacion', '') }}</small>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <i class="fas fa-euro-sign"></i> 
                                <strong>Tasa EUR Actual:</strong> 
                                <span id="tasaEurActual">{{ config.tasas.get('tasa_actual_eur', 266.60) }}</span>
                            </div>
                        </div>
                        <hr>
                        <button type="button" class="btn btn-sm btn-primary" onclick="actualizarTasaManual()">
                            <i class="fas fa-sync"></i> Actualizar Tasas Ahora
                        </button>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-cog section-icon"></i> Configuración de Tasas</h5>
                    
                    <!-- Moneda del Sistema -->
                    <div class="neo-form-group mb-4">
                        <label class="neo-label">
                            <i class="fas fa-exchange-alt"></i> Moneda del Sistema
                        </label>
                        <select name="moneda_sistema" class="neo-input">
                            <option value="USD" {% if config.tasas.get('moneda_sistema', 'USD') == 'USD' %}selected{% endif %}>USD (Dólares)</option>
                            <option value="EUR" {% if config.tasas.get('moneda_sistema', 'USD') == 'EUR' %}selected{% endif %}>EUR (Euros)</option>
                        </select>
                        <small class="help-text">La moneda principal que usará el sistema para cálculos en documentos y pagos</small>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-dollar-sign"></i> Tasa USD Manual
                                    <span class="config-badge">Backup</span>
                                </label>
                                <input type="number" step="0.01" name="tasa_usd_defecto" class="neo-input" 
                                       value="{{ config.tasas.tasa_usd_defecto }}" 
                                       placeholder="216.37">
                                <small class="help-text">Se usa si falla la obtención automática desde BCV</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-euro-sign"></i> Tasa EUR Manual
                                    <span class="config-badge">Backup</span>
                                </label>
                                <input type="number" step="0.01" name="tasa_eur_defecto" class="neo-input" 
                                       value="{{ config.tasas.get('tasa_eur_defecto', 235.00) }}" 
                                       placeholder="235.00">
                                <small class="help-text">Tasa EUR por defecto si falla la obtención automática</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-clock"></i> Intervalo de Actualización
                                </label>
                                <input type="number" name="intervalo_actualizacion" class="neo-input" 
                                       value="{{ config.tasas.intervalo_actualizacion }}">
                                <small class="help-text">Tiempo en segundos entre actualizaciones (3600 = 1 hora)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-form-group">
                        <label class="neo-label">
                            <i class="fas fa-database"></i> Fuente de Tasas
                        </label>
                        <select name="fuente_tasa" class="neo-input" id="fuenteTasa">
                            <option value="bcv" {% if config.tasas.fuente_tasa == 'bcv' %}selected{% endif %}>
                                BCV Oficial - https://www.bcv.org.ve/glosario/cambio-oficial
                            </option>
                            <option value="monitor" {% if config.tasas.fuente_tasa == 'monitor' %}selected{% endif %}>
                                Monitor Dólar - Tasa alternativa
                            </option>
                        </select>
                        <small class="help-text">
                            <strong>BCV Oficial:</strong> Obtiene tasas desde la página oficial del Banco Central de Venezuela.<br>
                            <strong>Monitor Dólar:</strong> Fuente alternativa de tasas de cambio.
                        </small>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-chart-line section-icon"></i> Historial de Tasas</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" id="guardar_historial_tasas" {% if config.get('tasas', {}).get('guardar_historial', True) %}checked{% endif %}>
                        <label for="guardar_historial_tasas">Guardar Historial de Tasas</label>
                        <small class="help-text d-block">Registra todas las tasas históricas para reportes y análisis</small>
                    </div>
                    
                    <div class="neo-form-group">
                        <label class="neo-label">
                            <i class="fas fa-percentage"></i> Umbral de Cambio Significativo (%)
                        </label>
                        <input type="number" step="0.1" class="neo-input" value="5" min="0" max="100">
                        <small class="help-text">Notifica cuando la tasa cambie más de este porcentaje (0-100)</small>
                    </div>
                </div>
            </div>

            <!-- NOTIFICACIONES -->
            <div id="tab-notificaciones" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-bell me-2"></i>Configuración de Notificaciones</h3>
                    <p class="text-muted mb-3">Configure cómo el sistema enviará notificaciones a clientes y usuarios.</p>
                    
                    <div class="alert alert-info mb-3" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Sistema de Notificaciones:</strong> Configure WhatsApp y Email para notificar automáticamente a los clientes sobre sus órdenes de servicio.
                    </div>
                    
                    <h5 class="mb-3"><i class="fab fa-whatsapp section-icon"></i> WhatsApp</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="whatsapp_habilitado" id="whatsapp_habilitado" 
                               {% if config.notificaciones.whatsapp_habilitado %}checked{% endif %}>
                        <label for="whatsapp_habilitado">
                            <strong>Habilitar Notificaciones por WhatsApp</strong>
                            <span class="help-text d-block">Envía mensajes automáticos a clientes con enlaces directos de WhatsApp Web</span>
                        </label>
                    </div>
                    
                    <div class="neo-form-group">
                        <label class="neo-label">
                            <i class="fas fa-key"></i> API Key / Token (Opcional)
                            <span class="config-badge">Opcional</span>
                        </label>
                        <input type="password" name="whatsapp_api_key" class="neo-input" 
                               value="{{ config.notificaciones.whatsapp_api_key }}" 
                               placeholder="Dejar vacío para usar enlaces directos">
                        <small class="help-text">Si usa servicios como Twilio API, coloque su token aquí. Si está vacío, usará enlaces directos de WhatsApp.</small>
                    </div>
                    
                    <div class="alert alert-success" style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 0.75rem;">
                        <i class="fas fa-check-circle"></i> 
                        <strong>Nota:</strong> El sistema actualmente usa enlaces directos de WhatsApp Web, por lo que no se requiere configuración adicional.
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-envelope section-icon"></i> Email (SMTP)</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="email_habilitado" id="email_habilitado" 
                               {% if config.notificaciones.email_habilitado %}checked{% endif %}>
                        <label for="email_habilitado">
                            <strong>Habilitar Notificaciones por Email</strong>
                            <span class="help-text d-block">Enviar correos electrónicos a clientes (requiere servidor SMTP configurado)</span>
                        </label>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-server"></i> Servidor SMTP
                                </label>
                                <input type="text" name="email_smtp_server" class="neo-input" 
                                       value="{{ config.notificaciones.email_smtp_server }}" 
                                       placeholder="smtp.gmail.com">
                                <small class="help-text">Ejemplo: smtp.gmail.com, smtp.outlook.com</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-network-wired"></i> Puerto SMTP
                                </label>
                                <input type="number" name="email_smtp_port" class="neo-input" 
                                       value="{{ config.notificaciones.email_smtp_port }}" 
                                       placeholder="587">
                                <small class="help-text">587 (TLS) o 465 (SSL)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-user"></i> Usuario Email
                                </label>
                                <input type="email" name="email_usuario" class="neo-input" 
                                       value="{{ config.notificaciones.email_usuario }}" 
                                       placeholder="tu-email@gmail.com">
                                <small class="help-text">Email para autenticación SMTP</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-lock"></i> Contraseña / App Password
                                </label>
                                <input type="password" name="email_password" class="neo-input" 
                                       value="{{ config.notificaciones.email_password }}" 
                                       placeholder="Tu contraseña o App Password">
                                <small class="help-text">Para Gmail, use "Contraseña de aplicación"</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-form-group">
                        <label class="neo-label">
                            <i class="fas fa-reply"></i> Email Remitente
                        </label>
                        <input type="email" name="email_remitente" class="neo-input" 
                               value="{{ config.notificaciones.email_remitente }}" 
                               placeholder="notificaciones@empresa.com">
                        <small class="help-text">Email que aparecerá como remitente en los correos</small>
                    </div>
                    
                    <div class="alert alert-warning" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 0.75rem;">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>Configuración de Gmail:</strong> Para usar Gmail, debe generar una "Contraseña de aplicación" desde su cuenta de Google. No use su contraseña normal.
                    </div>
                </div>
            </div>

            <!-- ALERTAS -->
            <div id="tab-alertas" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-exclamation-triangle me-2"></i>Alertas y Recordatorios del Sistema</h3>
                    <p class="text-muted mb-3">Configure qué alertas desea recibir para mantenerse informado sobre su negocio.</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Sistema de Alertas:</strong> Las alertas le notificarán automáticamente sobre eventos importantes que requieran su atención.
                        <br><small class="text-muted">🔔 <strong>Nota:</strong> El envío automático de alertas está en desarrollo. Actualmente puede generar reportes manualmente desde el servidor.</small>
                    </div>
                    
                    <div class="alert alert-warning mb-4" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem;">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>📧 Email configurado:</strong> <span id="emailConfig">Cargando...</span>
                        <br><small class="text-muted">Las alertas se enviarán a este correo cuando esté completamente habilitado.</small>
                    </div>
                    
                    <h5 class="mb-3"><i class="fas fa-file-invoice section-icon"></i> Alertas Financieras</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="vencimiento_notas_entrega" id="vencimiento_notas_entrega" {% if config.get('alertas', {}).get('vencimiento_notas_entrega', False) %}checked{% endif %}>
                        <label for="vencimiento_notas_entrega">
                            <strong>Vencimiento de Notas de Entrega</strong>
                            <span class="help-text d-block">Notificar cuando las notas de entrega estén próximas a vencer o ya vencieran</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="cuotas_vencidas" id="cuotas_vencidas" {% if config.get('alertas', {}).get('cuotas_vencidas', False) %}checked{% endif %}>
                        <label for="cuotas_vencidas">
                            <strong>Cuotas Vencidas</strong>
                            <span class="help-text d-block">Alertar sobre cuotas de pagos que han vencido sin cobrar</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="pagos_pendientes" id="pagos_pendientes" {% if config.get('alertas', {}).get('pagos_pendientes', False) %}checked{% endif %}>
                        <label for="pagos_pendientes">
                            <strong>Pagos Pendientes</strong>
                            <span class="help-text d-block">Notificar sobre pagos pendientes de clientes</span>
                        </label>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-boxes section-icon"></i> Alertas de Inventario</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="stock_minimo" id="stock_minimo" {% if config.get('alertas', {}).get('stock_minimo', False) %}checked{% endif %}>
                        <label for="stock_minimo">
                            <strong>Stock Mínimo</strong>
                            <span class="help-text d-block">Alertar cuando el inventario esté por debajo del nivel mínimo configurado</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="productos_agotados" id="productos_agotados" {% if config.get('alertas', {}).get('productos_agotados', False) %}checked{% endif %}>
                        <label for="productos_agotados">
                            <strong>Productos Agotados</strong>
                            <span class="help-text d-block">Notificar cuando productos se queden sin stock</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="productos_caducando" id="productos_caducando" {% if config.get('alertas', {}).get('productos_caducando', False) %}checked{% endif %}>
                        <label for="productos_caducando">
                            <strong>Productos Próximos a Caducar</strong>
                            <span class="help-text d-block">Avisar sobre productos que caducarán pronto</span>
                        </label>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-tools section-icon"></i> Alertas de Servicios</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="ordenes_pendientes" id="ordenes_pendientes" {% if config.get('alertas', {}).get('ordenes_pendientes', False) %}checked{% endif %}>
                        <label for="ordenes_pendientes">
                            <strong>Órdenes en Espera</strong>
                            <span class="help-text d-block">Notificar sobre órdenes de servicio que están en espera</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="ordenes_urgentes" id="ordenes_urgentes" {% if config.get('alertas', {}).get('ordenes_urgentes', False) %}checked{% endif %}>
                        <label for="ordenes_urgentes">
                            <strong>Órdenes Urgentes</strong>
                            <span class="help-text d-block">Alertar sobre órdenes marcadas como urgentes</span>
                        </label>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-users section-icon"></i> Alertas de Clientes</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="cumpleanos_clientes" id="cumpleanos_clientes" {% if config.get('alertas', {}).get('cumpleanos_clientes', False) %}checked{% endif %}>
                        <label for="cumpleanos_clientes">
                            <strong>Cumpleaños de Clientes</strong>
                            <span class="help-text d-block">Recordar cumpleaños de clientes para enviar felicitaciones</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="clientes_nuevos" id="clientes_nuevos" {% if config.get('alertas', {}).get('clientes_nuevos', False) %}checked{% endif %}>
                        <label for="clientes_nuevos">
                            <strong>Clientes Nuevos</strong>
                            <span class="help-text d-block">Notificar cuando se registren nuevos clientes</span>
                        </label>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-chart-line section-icon"></i> Reportes Automáticos</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="estadisticas_semanales" id="estadisticas_semanales" {% if config.get('alertas', {}).get('estadisticas_semanales', False) %}checked{% endif %}>
                        <label for="estadisticas_semanales">
                            <strong>Estadísticas Semanales</strong>
                            <span class="help-text d-block">Enviar un reporte semanal con resumen de ventas y servicios</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="estadisticas_mensuales" id="estadisticas_mensuales" {% if config.get('alertas', {}).get('estadisticas_mensuales', False) %}checked{% endif %}>
                        <label for="estadisticas_mensuales">
                            <strong>Estadísticas Mensuales</strong>
                            <span class="help-text d-block">Enviar un reporte mensual completo del negocio</span>
                        </label>
                    </div>
                    
                    <div class="alert alert-info mt-4" style="background: #d1ecf1; border-left: 4px solid #17a2b8; padding: 1rem;">
                        <i class="fas fa-rocket"></i> 
                        <strong>Generar Reportes Manualmente:</strong>
                        <br><br>
                        <button type="button" class="btn btn-success btn-sm me-2" onclick="generarYEnviarReporte('semanal')">
                            <i class="fab fa-whatsapp me-1"></i> Generar Reporte Semanal
                        </button>
                        <button type="button" class="btn btn-primary btn-sm" onclick="generarYEnviarReporte('mensual')">
                            <i class="fab fa-whatsapp me-1"></i> Generar Reporte Mensual
                        </button>
                        <br><br>
                        <small class="text-muted">Haz clic para generar un reporte y obtener el enlace de WhatsApp para enviarlo.</small>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-cog section-icon"></i> Configuración de Alertas</h5>
                    <div class="neo-form-group">
                        <label class="neo-label">
                            <i class="fas fa-bell"></i> Canal de Notificación Principal
                        </label>
                        <select name="canal_notificacion" class="neo-input">
                            <option value="email" {% if config.get('alertas', {}).get('canal_notificacion', 'email') == 'email' %}selected{% endif %}>Email</option>
                            <option value="whatsapp" {% if config.get('alertas', {}).get('canal_notificacion') == 'whatsapp' %}selected{% endif %}>WhatsApp</option>
                            <option value="ambos" {% if config.get('alertas', {}).get('canal_notificacion') == 'ambos' %}selected{% endif %}>Ambos</option>
                        </select>
                        <small class="help-text">Canal preferido para recibir las alertas</small>
                    </div>
                    
                    <div class="neo-form-group">
                        <label class="neo-label">
                            <i class="fas fa-clock"></i> Horario de Alertas (Hora Local)
                        </label>
                        <input type="time" name="horario_alertas" class="neo-input" value="{{ config.get('alertas', {}).get('horario_alertas', '08:00') }}">
                        <small class="help-text">Hora del día para enviar las alertas no urgentes</small>
                    </div>
                </div>
            </div>

            <!-- IMPRESIÓN -->
            <div id="tab-impresion" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-print me-2"></i>Configuración de Impresión</h3>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="logo_personalizado" id="logo_personalizado" {% if config.get('impresion', {}).get('logo_personalizado', False) %}checked{% endif %}>
                        <label for="logo_personalizado">Logo Personalizado</label>
                    </div>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="encabezados_personalizables" id="encabezados_personalizables" {% if config.get('impresion', {}).get('encabezados_personalizables', False) %}checked{% endif %}>
                        <label for="encabezados_personalizables">Encabezados Personalizables</label>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="neo-form-group">
                                <label class="neo-label">Margen Superior (mm)</label>
                                <input type="number" name="margen_superior" class="neo-input" value="{{ config.get('impresion', {}).get('margen_superior', '20') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="neo-form-group">
                                <label class="neo-label">Margen Inferior (mm)</label>
                                <input type="number" name="margen_inferior" class="neo-input" value="{{ config.get('impresion', {}).get('margen_inferior', '20') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="neo-form-group">
                                <label class="neo-label">Margen Izquierdo (mm)</label>
                                <input type="number" name="margen_izquierdo" class="neo-input" value="{{ config.get('impresion', {}).get('margen_izquierdo', '15') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="neo-form-group">
                                <label class="neo-label">Margen Derecho (mm)</label>
                                <input type="number" name="margen_derecho" class="neo-input" value="{{ config.get('impresion', {}).get('margen_derecho', '15') }}">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Orientación</label>
                                <select name="orientacion" class="neo-input">
                                    <option value="vertical" {% if config.get('impresion', {}).get('orientacion', 'vertical') == 'vertical' %}selected{% endif %}>Vertical</option>
                                    <option value="horizontal" {% if config.get('impresion', {}).get('orientacion') == 'horizontal' %}selected{% endif %}>Horizontal</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Tamaño Fuente</label>
                                <input type="number" name="tamano_fuente" class="neo-input" value="{{ config.get('impresion', {}).get('tamano_fuente', '12') }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Color Texto</label>
                                <input type="color" name="color_texto" class="neo-input" value="{{ config.get('impresion', {}).get('color_texto', '#000000') }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EQUIPOS CLIENTES -->
            <div id="tab-equipos" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-mobile-alt me-2"></i>Gestión de Equipos por Cliente</h3>
                    <p class="text-muted mb-4">Configure el seguimiento, estados y características de equipos de clientes</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Gestión de Equipos Completa:</strong> Configure seguimiento, estados, características y trazabilidad de equipos de clientes.
                    </div>
                    
                    {% set equipos = config.get('equipos_clientes', {}) %}
                    
                    <!-- CONFIGURACIÓN GENERAL -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-cog section-icon"></i> Configuración General</h5>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_habilitado" id="equipos_habilitado" 
                               {% if equipos.get('habilitado', True) %}checked{% endif %}>
                        <label for="equipos_habilitado"><strong>Habilitar Gestión de Equipos</strong></label>
                        <small class="help-text d-block">Activa el sistema completo de seguimiento de equipos</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_trazabilidad_completa" 
                               {% if equipos.get('trazabilidad_completa', True) %}checked{% endif %}>
                        <label><strong>Trazabilidad Completa</strong></label>
                        <small class="help-text d-block">Registra todos los movimientos del equipo (reparaciones, cambios, etc.)</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_historial_detallado" 
                               {% if equipos.get('historial_detallado', True) %}checked{% endif %}>
                        <label><strong>Historial Detallado</strong></label>
                        <small class="help-text d-block">Mantiene registro completo de todas las reparaciones</small>
                    </div>
                    
                    <!-- TIPOS Y MARCAS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-tags section-icon"></i> Tipos y Marcas</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Marcas Permitidas (separadas por comas)</label>
                        <input type="text" name="equipos_marcas_permitidas" class="neo-input" 
                               value="{{ equipos.get('marcas_permitidas', [])|join(', ') }}" 
                               placeholder="Apple, Samsung, Xiaomi, Huawei, Motorola, LG...">
                        <small class="help-text">Marcas que puede gestionar el sistema</small>
                    </div>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Modelos Disponibles (separados por coma)</label>
                        <input type="text" name="modelos_disponibles" class="neo-input" 
                               value="{{ equipos.get('modelos_disponibles', [])|join(', ') }}" 
                               placeholder="iPhone, Galaxy, Redmi, Mate, Edge...">
                        <small class="help-text">Modelos más comunes que se manejan</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_personalizar_modelos" 
                               {% if equipos.get('personalizar_modelos', True) %}checked{% endif %}>
                        <label><strong>Permitir Modelos Personalizados</strong></label>
                        <small class="help-text d-block">Permite agregar modelos que no están en la lista</small>
                    </div>
                    
                    <!-- ESTADOS DE EQUIPOS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-list-ul section-icon"></i> Estados de Equipos</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Estados de Equipos (separados por coma)</label>
                        <input type="text" name="estados_equipos" class="neo-input" 
                               value="{{ equipos.get('estados_equipos', [])|join(', ') }}" 
                               placeholder="En Reparación, Reparado, Entregado, Sin Arreglo, Esperando...">
                        <small class="help-text">Estados posibles de un equipo en el sistema</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_notificar_cambio_estado" 
                               {% if equipos.get('notificar_cambio_estado', True) %}checked{% endif %}>
                        <label><strong>Notificar Cambios de Estado</strong></label>
                        <small class="help-text d-block">Envía notificación al cliente cuando cambia el estado</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_auto_entregado" 
                               {% if equipos.get('auto_cambiar_entregado', False) %}checked{% endif %}>
                        <label><strong>Cambiar Estado a "Entregado" Automáticamente</strong></label>
                        <small class="help-text d-block">Al facturar/crear nota de entrega, marca como entregado</small>
                    </div>
                    
                    <!-- CONDICIÓN FÍSICA DEL EQUIPO -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-clipboard-check section-icon"></i> Condición Física del Equipo</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Condiciones Disponibles (separadas por coma)</label>
                        <input type="text" name="equipos_condicion_fisica" class="neo-input" 
                               value="{{ equipos.get('condicion_fisica_opciones', [])|join(', ') }}" 
                               placeholder="Excelente, Bueno, Regular, Malo, Muy Malo, Dañado...">
                        <small class="help-text">Opciones de condición física del equipo</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_fotos_condicion" 
                               {% if equipos.get('fotos_condicion', True) %}checked{% endif %}>
                        <label><strong>Permitir Fotos de Condición</strong></label>
                        <small class="help-text d-block">Subir fotos del estado físico del equipo</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_descripcion_danos" 
                               {% if equipos.get('descripcion_danos', True) %}checked{% endif %}>
                        <label><strong>Descripción Detallada de Daños</strong></label>
                        <small class="help-text d-block">Permite agregar descripción detallada de daños</small>
                    </div>
                    
                    <!-- ACCESORIOS ENTREGADOS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-box section-icon"></i> Accesorios Entregados</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Tipos de Accesorios (separados por coma)</label>
                        <input type="text" name="equipos_tipos_accesorios" class="neo-input" 
                               value="{{ equipos.get('tipos_accesorios', [])|join(', ') }}" 
                               placeholder="Cargador, Cable, Funda, Estuche, Auriculares, SIM Card...">
                        <small class="help-text">Tipos de accesorios que pueden entregarse con el equipo</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_registrar_accesorios" 
                               {% if equipos.get('registrar_accesorios_entregados', True) %}checked{% endif %}>
                        <label><strong>Registrar Accesorios Entregados</strong></label>
                        <small class="help-text d-block">Captura qué accesorios se entregan con el equipo</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_alertar_accesorios_faltantes" 
                               {% if equipos.get('alertar_accesorios_faltantes', False) %}checked{% endif %}>
                        <label><strong>Alertar Accesorios Faltantes</strong></label>
                        <small class="help-text d-block">Notifica si faltan accesorios al recibir equipos</small>
                    </div>
                    
                    <!-- CARACTERÍSTICAS TÉCNICAS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-microchip section-icon"></i> Características Técnicas</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_registrar_imei" 
                               {% if equipos.get('registrar_imei', True) %}checked{% endif %}>
                        <label><strong>Registrar IMEI</strong></label>
                        <small class="help-text d-block">Captura el número IMEI del equipo</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_registrar_serial" 
                               {% if equipos.get('registrar_serial', True) %}checked{% endif %}>
                        <label><strong>Registrar Número de Serie</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_especificaciones" 
                               {% if equipos.get('especificaciones_completas', False) %}checked{% endif %}>
                        <label><strong>Especificaciones Completas</strong></label>
                        <small class="help-text d-block">Almacenar: RAM, ROM, procesador, pantalla, etc.</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_codigo_barras" 
                               {% if equipos.get('codigo_barras', False) %}checked{% endif %}>
                        <label><strong>Código de Barras del Equipo</strong></label>
                        <small class="help-text d-block">Genera y gestiona códigos de barras para cada equipo</small>
                    </div>
                    
                    <!-- DATOS ADICIONALES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-info-circle section-icon"></i> Datos Adicionales del Equipo</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Color (separados por coma)</label>
                        <input type="text" name="equipos_colores_disponibles" class="neo-input" 
                               value="{{ equipos.get('colores_disponibles', [])|join(', ') }}" 
                               placeholder="Negro, Blanco, Azul, Rojo, Dorado, Plateado...">
                        <small class="help-text">Colores comunes de equipos</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="equipos_capacidad_almacenamiento" 
                                       {% if equipos.get('registrar_capacidad_almacenamiento', False) %}checked{% endif %}>
                                <label>Registrar Capacidad de Almacenamiento</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="equipos_version_sistema" 
                                       {% if equipos.get('registrar_version_sistema', False) %}checked{% endif %}>
                                <label>Registrar Versión de Sistema Operativo</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_numero_telefono" 
                               {% if equipos.get('registrar_numero_telefono', False) %}checked{% endif %}>
                        <label><strong>Registrar Número de Teléfono del Equipo</strong></label>
                        <small class="help-text d-block">Captura el número de teléfono del dispositivo</small>
                    </div>
                    
                    <!-- GARANTÍAS Y REPARACIONES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-shield-alt section-icon"></i> Garantías y Reparaciones</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Garantía Estándar (días)</label>
                                <input type="number" name="equipos_garantia_estandar" class="neo-input" 
                                       value="{{ equipos.get('garantia_estandar', 30) }}" min="0" max="365">
                                <small class="help-text">Días de garantía por defecto</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Alerta de Garantía (días antes)</label>
                                <input type="number" name="equipos_alerta_garantia" class="neo-input" 
                                       value="{{ equipos.get('alerta_garantia', 7) }}" min="1" max="30">
                                <small class="help-text">Días antes de vencer para alertar</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_validar_garantia" 
                               {% if equipos.get('validar_garantia', True) %}checked{% endif %}>
                        <label><strong>Validar Garantía al Crear Orden</strong></label>
                        <small class="help-text d-block">Verifica que el equipo esté en garantía</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_reparaciones_multiples" 
                               {% if equipos.get('reparaciones_multiples', True) %}checked{% endif %}>
                        <label><strong>Historial de Reparaciones Múltiples</strong></label>
                        <small class="help-text d-block">Permite registrar múltiples reparaciones por equipo</small>
                    </div>
                    
                    <!-- INVENTARIO DE EQUIPOS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-warehouse section-icon"></i> Inventario de Equipos</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_inventario_en_lugar" 
                               {% if equipos.get('inventario_en_lugar', False) %}checked{% endif %}>
                        <label><strong>Control de Equipos en Lugar</strong></label>
                        <small class="help-text d-block">Rastrea equipos en poder del negocio</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_alertar_equipos_largos" 
                               {% if equipos.get('alertar_equipos_largos', True) %}checked{% endif %}>
                        <label><strong>Alertar Equipos Mucho Tiempo</strong></label>
                        <small class="help-text d-block">Notifica cuando un equipo lleva mucho tiempo sin entregar</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo Máximo sin Entregar (días)</label>
                                <input type="number" name="equipos_tiempo_max_entrega" class="neo-input" 
                                       value="{{ equipos.get('tiempo_max_entrega', 30) }}" min="7" max="180">
                                <small class="help-text">Días antes de considerar "demasiado tiempo"</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Revisión Periódica (días)</label>
                                <input type="number" name="equipos_revision_periodica" class="neo-input" 
                                       value="{{ equipos.get('revision_periodica', 7) }}" min="1" max="30">
                                <small class="help-text">Cada cuántos días revisar equipos pendientes</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- VALORACIÓN Y PRECIOS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-dollar-sign section-icon"></i> Valoración y Precios</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_valor_mercado" 
                               {% if equipos.get('valor_mercado', False) %}checked{% endif %}>
                        <label><strong>Registrar Valor de Mercado</strong></label>
                        <small class="help-text d-block">Guarda el valor de mercado del equipo</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_valor_reparacion" 
                               {% if equipos.get('valor_reparacion', True) %}checked{% endif %}>
                        <label><strong>Registrar Valor de Reparación</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_comparar_precios" 
                               {% if equipos.get('comparar_precios_reparacion', False) %}checked{% endif %}>
                        <label><strong>Comparar Precios de Reparación</strong></label>
                        <small class="help-text d-block">Alerta si el costo de reparación excede el valor del equipo</small>
                    </div>
                    
                    <!-- SERVICIOS ADICIONALES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-tools section-icon"></i> Servicios Adicionales</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Servicios Disponibles (separados por coma)</label>
                        <input type="text" name="equipos_servicios_disponibles" class="neo-input" 
                               value="{{ equipos.get('servicios_disponibles', [])|join(', ') }}" 
                               placeholder="Reparación de Pantalla, Cambio de Batería, Actualización de Software...">
                        <small class="help-text">Servicios que se pueden realizar en equipos</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_costos_adicionales" 
                               {% if equipos.get('registrar_costos_adicionales', True) %}checked{% endif %}>
                        <label><strong>Registrar Costos Adicionales</strong></label>
                        <small class="help-text d-block">Permite agregar costos extra como repuestos, envío, etc.</small>
                    </div>
                    
                    <!-- ESTADÍSTICAS Y REPORTES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-chart-pie section-icon"></i> Estadísticas y Reportes</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_reportes_frecuencia" 
                               {% if equipos.get('reportes_frecuencia_equipos', True) %}checked{% endif %}>
                        <label><strong>Reportes de Frecuencia de Equipos</strong></label>
                        <small class="help-text d-block">Identifica clientes con múltiples reparaciones</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_estadisticas_marcas" 
                               {% if equipos.get('estadisticas_marcas', True) %}checked{% endif %}>
                        <label><strong>Estadísticas por Marca</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="equipos_estadisticas_modelos" 
                               {% if equipos.get('estadisticas_modelos', True) %}checked{% endif %}>
                        <label><strong>Estadísticas por Modelo</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="equipos_reportes_reparaciones" 
                               {% if equipos.get('reportes_reparaciones', True) %}checked{% endif %}>
                        <label><strong>Reportes de Reparaciones</strong></label>
                        <small class="help-text d-block">Genera reportes automáticos de equipos en reparación</small>
                    </div>
                </div>
            </div>

            <!-- DOCUMENTOS -->
            <div id="tab-documentos" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-file-alt me-2"></i>Documentos</h3>
                    <div class="neo-form-group">
                        <label class="neo-label">Formato Número Orden</label>
                        <input type="text" name="formato_numero_orden" class="neo-input" value="{{ config.get('documentos', {}).get('formato_numero_orden', 'OS-{YYYYMMDD}{####}') }}">
                    </div>
                    <div class="neo-form-group">
                        <label class="neo-label">Formato Número Factura</label>
                        <input type="text" name="formato_numero_factura" class="neo-input" value="{{ config.get('documentos', {}).get('formato_numero_factura', 'FAC-{YYYYMMDD}{####}') }}">
                    </div>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="mostrar_logo" id="mostrar_logo" {% if config.get('documentos', {}).get('mostrar_logo', True) %}checked{% endif %}>
                        <label for="mostrar_logo">Mostrar Logo en Documentos</label>
                    </div>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="mostrar_codigo_barras" id="mostrar_codigo_barras" {% if config.get('documentos', {}).get('mostrar_codigo_barras', False) %}checked{% endif %}>
                        <label for="mostrar_codigo_barras">Mostrar Código de Barras</label>
                    </div>
                </div>
            </div>

            <!-- ESTADOS -->
            <div id="tab-estados" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-tasks me-2"></i>Estados de Órdenes</h3>
                    <p class="text-muted">Configuración avanzada de estados para órdenes de servicio</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Configuración de Estados:</strong> Personalice cada estado con campos obligatorios, tiempos máximos, permisos y notificaciones.
                    </div>
                    
                    {% set estados = config.get('estados_ordenes', {}) %}
                    
                    <!-- Configuración de En Espera/Recibido -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-clock text-warning"></i> En Espera de Revisión</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo Máximo (horas)</label>
                                <input type="number" name="estado_recibido_tiempo_max" class="neo-input" 
                                       value="{{ estados.get('recibido', {}).get('tiempo_maximo', 24) }}" min="1">
                                <small class="help-text">Tiempo máximo antes de pasar a diagnóstico</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Campos Obligatorios</label>
                                <input type="text" name="estado_recibido_campos" class="neo-input" 
                                       value="{{ estados.get('recibido', {}).get('campos_obligatorios', 'equipo,cliente')|join(',') }}">
                                <small class="help-text">Separados por comas (equipo, cliente, etc.)</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="estado_recibido_notificar" 
                                       {% if estados.get('recibido', {}).get('notificar_cliente', True) %}checked{% endif %}>
                                <label>Notificar al Cliente</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configuración de En Diagnóstico -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-search text-info"></i> En Diagnóstico</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo Máximo (horas)</label>
                                <input type="number" name="estado_diagnostico_tiempo_max" class="neo-input" 
                                       value="{{ estados.get('diagnostico', {}).get('tiempo_maximo', 72) }}" min="1">
                                <small class="help-text">Tiempo máximo de diagnóstico</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Campos Obligatorios</label>
                                <input type="text" name="estado_diagnostico_campos" class="neo-input" 
                                       value="{{ estados.get('diagnostico', {}).get('campos_obligatorios', 'diagnostico')|join(',') }}">
                                <small class="help-text">Separados por comas</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="estado_diagnostico_notificar" 
                                       {% if estados.get('diagnostico', {}).get('notificar_cliente', True) %}checked{% endif %}>
                                <label>Notificar al Cliente</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configuración de En Reparación -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-tools text-primary"></i> En Reparación</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo Máximo (horas)</label>
                                <input type="number" name="estado_reparacion_tiempo_max" class="neo-input" 
                                       value="{{ estados.get('en_reparacion', {}).get('tiempo_maximo', 168) }}" min="1">
                                <small class="help-text">Tiempo máximo de reparación (7 días)</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Solo Admin</label>
                                <select name="estado_reparacion_requiere_admin" class="neo-input">
                                    <option value="false">No</option>
                                    <option value="true" {% if estados.get('en_reparacion', {}).get('requiere_admin', False) %}selected{% endif %}>Sí</option>
                                </select>
                                <small class="help-text">Solo administradores pueden cambiar este estado</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="estado_reparacion_comentario_obligatorio" 
                                       {% if estados.get('en_reparacion', {}).get('comentario_obligatorio', False) %}checked{% endif %}>
                                <label>Comentario Obligatorio</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configuración de Reparado -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-check-double text-success"></i> Reparado</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo Máximo (horas)</label>
                                <input type="number" name="estado_reparado_tiempo_max" class="neo-input" 
                                       value="{{ estados.get('reparado', {}).get('tiempo_maximo', 48) }}" min="1">
                                <small class="help-text">Tiempo máximo antes de entrega</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Requiere Aprobación</label>
                                <select name="estado_reparado_requiere_aprobacion" class="neo-input">
                                    <option value="false">No</option>
                                    <option value="true" {% if estados.get('reparado', {}).get('requiere_aprobacion', True) %}selected{% endif %}>Sí</option>
                                </select>
                                <small class="help-text">Requiere confirmación de supervisor</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="estado_reparado_notificar" 
                                       {% if estados.get('reparado', {}).get('notificar_cliente', True) %}checked{% endif %}>
                                <label>Notificar al Cliente</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configuración de Entregado -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-handshake text-secondary"></i> Entregado</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Solo Admin</label>
                                <select name="estado_entregado_requiere_admin" class="neo-input">
                                    <option value="false">No</option>
                                    <option value="true" {% if estados.get('entregado', {}).get('requiere_admin', True) %}selected{% endif %}>Sí</option>
                                </select>
                                <small class="help-text">Solo administradores pueden marcar como entregado</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="estado_entregado_requiere_firma" 
                                       {% if estados.get('entregado', {}).get('requiere_firma', True) %}checked{% endif %}>
                                <label>Requiere Firma Digital</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="estado_entregado_notificar" 
                                       {% if estados.get('entregado', {}).get('notificar_cliente', True) %}checked{% endif %}>
                                <label>Notificar al Cliente</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alertas y Notificaciones -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-bell section-icon"></i> Alertas por Estado</h5>
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alertas_estados_vencidos" 
                               {% if config.get('alertas', {}).get('estados_vencidos', True) %}checked{% endif %}>
                        <label><strong>Alertar por Estados Vencidos</strong></label>
                        <small class="help-text d-block">Enviar notificaciones cuando una orden exceda el tiempo máximo configurado</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alertas_estados_pendientes" 
                               {% if config.get('alertas', {}).get('estados_pendientes', True) %}checked{% endif %}>
                        <label><strong>Recordatorio de Estados Pendientes</strong></label>
                        <small class="help-text d-block">Recordar diariamente sobre órdenes en estados intermedios</small>
                    </div>
                </div>
            </div>

            <!-- PAGOS -->
            <div id="tab-pagos" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-money-bill-wave me-2"></i>Métodos de Pago</h3>
                    <p class="text-muted mb-3">Configure los métodos de pago aceptados y su información detallada.</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Métodos de Pago:</strong> Habilite o deshabilite los métodos de pago que acepta en su negocio. Configure los detalles de cada uno.
                    </div>
                    
                    {% set metodos = config.get('metodos_pago', {}) %}
                    <h5 class="mb-3"><i class="fas fa-hand-holding-usd section-icon"></i> Métodos Disponibles</h5>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="pago_efectivo" id="pago_efectivo" {% if metodos.get('efectivo', {}).get('habilitado', True) %}checked{% endif %}>
                                <label for="pago_efectivo">
                                    <strong>💵 Efectivo</strong>
                                    <span class="help-text d-block">Aceptar pagos en efectivo</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="pago_transferencia" id="pago_transferencia" {% if metodos.get('transferencia', {}).get('habilitado', True) %}checked{% endif %}>
                                <label for="pago_transferencia">
                                    <strong>🏦 Transferencia Bancaria</strong>
                                    <span class="help-text d-block">Transferencias a cuenta bancaria</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="pago_pago_movil" id="pago_pago_movil" {% if metodos.get('pago_movil', {}).get('habilitado', True) %}checked{% endif %}>
                                <label for="pago_pago_movil">
                                    <strong>📱 Pago Móvil</strong>
                                    <span class="help-text d-block">Pagos a través de Pago Móvil Venezuela</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="pago_zelle" id="pago_zelle" {% if metodos.get('zelle', {}).get('habilitado', True) %}checked{% endif %}>
                                <label for="pago_zelle">
                                    <strong>💳 Zelle</strong>
                                    <span class="help-text d-block">Pagos a través de Zelle</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="pago_paypal" id="pago_paypal" {% if metodos.get('paypal', {}).get('habilitado', False) %}checked{% endif %}>
                                <label for="pago_paypal">
                                    <strong>🌐 PayPal</strong>
                                    <span class="help-text d-block">Pagos a través de PayPal</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="pago_binance" id="pago_binance" {% if metodos.get('binance', {}).get('habilitado', False) %}checked{% endif %}>
                                <label for="pago_binance">
                                    <strong>₿ Binance</strong>
                                    <span class="help-text d-block">Pagos con Binance (Criptomonedas)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-cog section-icon"></i> Configuración de Información Bancaria</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-university"></i> Banco
                                </label>
                                <input type="text" name="banco_nombre" class="neo-input" value="{{ config.get('metodos_pago', {}).get('banco_nombre', '') }}" placeholder="Banesco, Mercantil...">
                                <small class="help-text">Nombre del banco principal</small>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-credit-card"></i> Tipo de Cuenta
                                </label>
                                <select name="tipo_cuenta" class="neo-input">
                                    <option value="corriente" {% if config.get('metodos_pago', {}).get('tipo_cuenta', 'corriente') == 'corriente' %}selected{% endif %}>Corriente</option>
                                    <option value="ahorro" {% if config.get('metodos_pago', {}).get('tipo_cuenta') == 'ahorro' %}selected{% endif %}>Ahorro</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-hashtag"></i> Número de Cuenta
                                </label>
                                <input type="text" name="numero_cuenta" class="neo-input" value="{{ config.get('metodos_pago', {}).get('numero_cuenta', '') }}" placeholder="0208-xxxx-xxxxx-xxxxxxx-2">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-user"></i> Titular de la Cuenta
                                </label>
                                <input type="text" name="titular_cuenta" class="neo-input" value="{{ config.get('metodos_pago', {}).get('titular_cuenta', config.get('empresa', {}).get('nombre', '')) }}" placeholder="Nombre del titular">
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-phone"></i> Teléfono Pago Móvil
                                </label>
                                <input type="text" name="telefono_pago_movil" class="neo-input" value="{{ config.get('metodos_pago', {}).get('telefono_pago_movil', '') }}" placeholder="0412-1234567">
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-info-circle section-icon"></i> Información de Métodos de Pago</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-envelope"></i> Email Zelle
                                </label>
                                <input type="email" name="email_zelle" class="neo-input" value="{{ config.get('metodos_pago', {}).get('email_zelle', '') }}" placeholder="correo@ejemplo.com">
                                <small class="help-text">Correo de Zelle para recibir pagos</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-envelope"></i> Email Binance
                                </label>
                                <input type="email" name="email_binance" class="neo-input" value="{{ config.get('metodos_pago', {}).get('email_binance', '') }}" placeholder="correo@ejemplo.com">
                                <small class="help-text">Correo asociado a Binance</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-phone"></i> Teléfono Pago Móvil
                                </label>
                                <input type="text" name="telefono_pago_movil" class="neo-input" value="{{ config.get('metodos_pago', {}).get('telefono_pago_movil', '') }}" placeholder="0412-1234567">
                                <small class="help-text">Teléfono registrado en Pago Móvil</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="neo-form-group">
                                <label class="neo-label">
                                    <i class="fas fa-id-card"></i> Cédula RIF Pago Móvil
                                </label>
                                <input type="text" name="cedula_pago_movil" class="neo-input" value="{{ config.get('metodos_pago', {}).get('cedula_pago_movil', '') }}" placeholder="V-12345678 o J-12345678-9">
                                <small class="help-text">Cédula o RIF registrado en Pago Móvil</small>
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-cash-register section-icon"></i> Configuración de Efectivo</h5>
                    <div class="alert alert-warning mb-3" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem;">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>Nota:</strong> Configure si acepta efectivo en USD y/o Bolívares
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="aceptar_efectivo_usd" id="aceptar_efectivo_usd" {% if config.get('metodos_pago', {}).get('aceptar_efectivo_usd', True) %}checked{% endif %}>
                                <label for="aceptar_efectivo_usd">
                                    <strong>Aceptar Efectivo en USD</strong>
                                    <span class="help-text d-block">Permitir pagos en efectivo en dólares americanos</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="aceptar_efectivo_bs" id="aceptar_efectivo_bs" {% if config.get('metodos_pago', {}).get('aceptar_efectivo_bs', True) %}checked{% endif %}>
                                <label for="aceptar_efectivo_bs">
                                    <strong>Aceptar Efectivo en Bs</strong>
                                    <span class="help-text d-block">Permitir pagos en efectivo en bolívares</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3 mt-4"><i class="fas fa-bell section-icon"></i> Notificaciones de Pagos</h5>
                    <div class="neo-checkbox">
                        <input type="checkbox" name="notificar_pago_cliente" id="notificar_pago_cliente" {% if config.get('metodos_pago', {}).get('notificar_pago_cliente', False) %}checked{% endif %}>
                        <label for="notificar_pago_cliente">
                            <strong>Notificar al Cliente al Registrar Pago</strong>
                            <span class="help-text d-block">Enviar mensaje automático cuando se registre un pago</span>
                        </label>
                    </div>
                    
                    <div class="neo-checkbox">
                        <input type="checkbox" name="notificar_nota_entregada" id="notificar_nota_entregada" {% if config.get('metodos_pago', {}).get('notificar_nota_entregada', False) %}checked{% endif %}>
                        <label for="notificar_nota_entregada">
                            <strong>Notificar al Marcar Nota como Entregada</strong>
                            <span class="help-text d-block">Enviar mensaje cuando se marque una nota de entrega como entregada</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- CATEGORÍAS -->
            <div id="tab-categorias" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-tags me-2"></i>Categorías</h3>
                    <p class="text-muted mb-4">Configure los tipos de clientes y prioridades del sistema con colores e iconos personalizados</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Sistema de Tags Mejorado:</strong> Arrastra para reordenar, haz clic para editar, personaliza colores e iconos.
                    </div>
                    
                    {% set categorias = config.get('categorias', {}) %}
                    {% set tipos_clientes = categorias.get('tipos_clientes', []) %}
                    {% set prioridades = categorias.get('prioridades', []) %}
                    
                    <!-- Tipos de Clientes -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-users section-icon"></i> Tipos de Clientes</h5>
                    <div class="neo-form-group mb-4">
                        <label class="neo-label">
                            <i class="fas fa-plus-circle"></i> Agregar Nuevo Tipo
                            <span class="help-text d-block mb-2">Separe los valores por comas o haga clic en "Añadir" para agregarlos individualmente</span>
                        </label>
                        <div class="input-group mb-3">
                            <input type="text" id="nuevoTipoCliente" class="neo-input" placeholder="Ej: VIP, Regular, Corporativo">
                            <button type="button" class="btn btn-primary" onclick="agregarTipoCliente()">
                                <i class="fas fa-plus"></i> Añadir
                            </button>
                        </div>
                        
                        <!-- Container para Tags de Tipos de Clientes -->
                        <div id="tiposClientesContainer" class="tags-container" style="min-height: 80px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            {% if tipos_clientes %}
                                {% for tipo in tipos_clientes %}
                                    {% if tipo.get('nombre') %}
                                    <div class="custom-tag" data-tipo="tipo_cliente" style="background: {{ tipo.get('color', '#007bff') }};">
                                        <span class="tag-icon"><i class="{{ tipo.get('icono', 'fas fa-user') }}"></i></span>
                                        <input type="text" class="tag-name" value="{{ tipo.get('nombre') }}" data-original="{{ tipo.get('nombre') }}">
                                        <select class="tag-color" onchange="cambiarColor(this)">
                                            <option value="#007bff" {% if tipo.get('color') == '#007bff' %}selected{% endif %}>🔵 Azul</option>
                                            <option value="#28a745" {% if tipo.get('color') == '#28a745' %}selected{% endif %}>🟢 Verde</option>
                                            <option value="#ffc107" {% if tipo.get('color') == '#ffc107' %}selected{% endif %}>🟡 Amarillo</option>
                                            <option value="#dc3545" {% if tipo.get('color') == '#dc3545' %}selected{% endif %}>🔴 Rojo</option>
                                            <option value="#6f42c1" {% if tipo.get('color') == '#6f42c1' %}selected{% endif %}>🟣 Púrpura</option>
                                            <option value="#fd7e14" {% if tipo.get('color') == '#fd7e14' %}selected{% endif %}>🟠 Naranja</option>
                                        </select>
                                        <select class="tag-icon-select" onchange="cambiarIcono(this)">
                                            <option value="fas fa-user" {% if tipo.get('icono') == 'fas fa-user' %}selected{% endif %}>👤 Usuario</option>
                                            <option value="fas fa-crown" {% if tipo.get('icono') == 'fas fa-crown' %}selected{% endif %}>👑 VIP</option>
                                            <option value="fas fa-building" {% if tipo.get('icono') == 'fas fa-building' %}selected{% endif %}>🏢 Corporativo</option>
                                            <option value="fas fa-star" {% if tipo.get('icono') == 'fas fa-star' %}selected{% endif %}>⭐ Estrella</option>
                                        </select>
                                        <button type="button" class="btn-tag-delete" onclick="eliminarTag(this)">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <p class="text-muted">No hay tipos de clientes configurados</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Prioridades -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-exclamation-triangle section-icon"></i> Prioridades</h5>
                    <div class="neo-form-group mb-4">
                        <label class="neo-label">
                            <i class="fas fa-plus-circle"></i> Agregar Nueva Prioridad
                            <span class="help-text d-block mb-2">Arrastre para reordenar (importante para el orden semántico)</span>
                        </label>
                        <div class="input-group mb-3">
                            <input type="text" id="nuevaPrioridad" class="neo-input" placeholder="Ej: Baja, Media, Alta, Urgente">
                            <button type="button" class="btn btn-primary" onclick="agregarPrioridad()">
                                <i class="fas fa-plus"></i> Añadir
                            </button>
                        </div>
                        
                        <!-- Container para Tags de Prioridades -->
                        <div id="prioridadesContainer" class="tags-container" style="min-height: 80px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            {% if prioridades %}
                                {% for prioridad in prioridades %}
                                    {% if prioridad.get('nombre') %}
                                    <div class="custom-tag" data-tipo="prioridad" data-priority="{{ loop.index }}" style="background: {{ prioridad.get('color', '#ffc107') }};">
                                        <span class="tag-icon"><i class="{{ prioridad.get('icono', 'fas fa-flag') }}"></i></span>
                                        <input type="text" class="tag-name" value="{{ prioridad.get('nombre') }}" data-original="{{ prioridad.get('nombre') }}">
                                        <select class="tag-color" onchange="cambiarColor(this)">
                                            <option value="#17a2b8" {% if prioridad.get('color') == '#17a2b8' %}selected{% endif %}>🔵 Baja</option>
                                            <option value="#ffc107" {% if prioridad.get('color') == '#ffc107' %}selected{% endif %}>🟡 Media</option>
                                            <option value="#fd7e14" {% if prioridad.get('color') == '#fd7e14' %}selected{% endif %}>🟠 Alta</option>
                                            <option value="#dc3545" {% if prioridad.get('color') == '#dc3545' %}selected{% endif %}>🔴 Urgente</option>
                                        </select>
                                        <select class="tag-icon-select" onchange="cambiarIcono(this)">
                                            <option value="fas fa-flag" {% if prioridad.get('icono') == 'fas fa-flag' %}selected{% endif %}>🏳️ Bandera</option>
                                            <option value="fas fa-clock" {% if prioridad.get('icono') == 'fas fa-clock' %}selected{% endif %}>⏰ Reloj</option>
                                            <option value="fas fa-fire" {% if prioridad.get('icono') == 'fas fa-fire' %}selected{% endif %}>🔥 Fuego</option>
                                            <option value="fas fa-bolt" {% if prioridad.get('icono') == 'fas fa-bolt' %}selected{% endif %}>⚡ Ráfaga</option>
                                        </select>
                                        <button type="button" class="btn-tag-delete" onclick="eliminarTag(this)">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <p class="text-muted">No hay prioridades configuradas</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Botón de guardar -->
                    <div class="mt-4">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </div>
                </div>
            </div>
            
            <style>
            .tags-container {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                align-items: flex-start;
            }
            
            .custom-tag {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 8px 12px;
                border-radius: 20px;
                background: #007bff;
                color: white;
                font-size: 14px;
                cursor: move;
                transition: all 0.3s;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .custom-tag:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            }
            
            .tag-icon {
                font-size: 16px;
            }
            
            .tag-name {
                background: transparent;
                border: none;
                color: white;
                font-weight: 500;
                padding: 4px 8px;
                border-radius: 4px;
                min-width: 80px;
            }
            
            .tag-name:focus {
                background: rgba(255,255,255,0.2);
                outline: 2px solid white;
            }
            
            .tag-color, .tag-icon-select {
                background: rgba(255,255,255,0.3);
                border: 1px solid rgba(255,255,255,0.5);
                color: white;
                border-radius: 4px;
                padding: 4px 8px;
                font-size: 12px;
            }
            
            .tag-color option, .tag-icon-select option {
                background: #333;
                color: white;
            }
            
            .btn-tag-delete {
                background: rgba(255,255,255,0.3);
                border: none;
                color: white;
                border-radius: 50%;
                width: 24px;
                height: 24px;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .btn-tag-delete:hover {
                background: rgba(255,255,255,0.5);
                transform: scale(1.1);
            }
            </style>
            
            <script>
            // Funciones para manejar tipos de clientes
            function agregarTipoCliente() {
                const input = document.getElementById('nuevoTipoCliente');
                const texto = input.value.trim();
                
                if (!texto) {
                    alert('Por favor ingrese un tipo de cliente');
                    return;
                }
                
                const items = texto.split(',').map(item => item.trim()).filter(item => item);
                
                items.forEach(item => {
                    const container = document.getElementById('tiposClientesContainer');
                    const nuevoTag = crearTag('tipo_cliente', item, '#007bff', 'fas fa-user');
                    container.appendChild(nuevoTag);
                });
                
                input.value = '';
            }
            
            // Funciones para manejar prioridades
            function agregarPrioridad() {
                const input = document.getElementById('nuevaPrioridad');
                const texto = input.value.trim();
                
                if (!texto) {
                    alert('Por favor ingrese una prioridad');
                    return;
                }
                
                const items = texto.split(',').map(item => item.trim()).filter(item => item);
                
                items.forEach(item => {
                    const container = document.getElementById('prioridadesContainer');
                    const nuevoTag = crearTag('prioridad', item, '#ffc107', 'fas fa-flag');
                    container.appendChild(nuevoTag);
                });
                
                input.value = '';
            }
            
            function crearTag(tipo, nombre, color, icono) {
                const div = document.createElement('div');
                div.className = 'custom-tag';
                div.setAttribute('data-tipo', tipo);
                div.style.background = color;
                div.innerHTML = `
                    <span class="tag-icon"><i class="${icono}"></i></span>
                    <input type="text" class="tag-name" value="${nombre}" data-original="${nombre}">
                    <select class="tag-color" onchange="cambiarColor(this)">
                        <option value="#007bff" ${color === '#007bff' ? 'selected' : ''}>🔵 Azul</option>
                        <option value="#28a745" ${color === '#28a745' ? 'selected' : ''}>🟢 Verde</option>
                        <option value="#ffc107" ${color === '#ffc107' ? 'selected' : ''}>🟡 Amarillo</option>
                        <option value="#dc3545" ${color === '#dc3545' ? 'selected' : ''}>🔴 Rojo</option>
                        <option value="#6f42c1" ${color === '#6f42c1' ? 'selected' : ''}>🟣 Púrpura</option>
                        <option value="#fd7e14" ${color === '#fd7e14' ? 'selected' : ''}>🟠 Naranja</option>
                    </select>
                    <select class="tag-icon-select" onchange="cambiarIcono(this)">
                        <option value="fas fa-user">👤 Usuario</option>
                        <option value="fas fa-crown">👑 VIP</option>
                        <option value="fas fa-building">🏢 Corporativo</option>
                        <option value="fas fa-flag">🏳️ Bandera</option>
                        <option value="fas fa-clock">⏰ Reloj</option>
                        <option value="fas fa-fire">🔥 Fuego</option>
                    </select>
                    <button type="button" class="btn-tag-delete" onclick="eliminarTag(this)">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                return div;
            }
            
            function cambiarColor(select) {
                const tag = select.closest('.custom-tag');
                const color = select.value;
                tag.style.background = color;
            }
            
            function cambiarIcono(select) {
                const tag = select.closest('.custom-tag');
                const icono = select.value;
                const iconSpan = tag.querySelector('.tag-icon i');
                iconSpan.className = icono;
            }
            
            function eliminarTag(button) {
                if (confirm('¿Está seguro de que desea eliminar este elemento?')) {
                    const tag = button.closest('.custom-tag');
                    tag.remove();
                }
            }
            
            // Inicializar drag and drop
            document.addEventListener('DOMContentLoaded', function() {
                initializeDragAndDrop('tiposClientesContainer');
                initializeDragAndDrop('prioridadesContainer');
            });
            
            function initializeDragAndDrop(containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                let draggedElement = null;
                
                container.querySelectorAll('.custom-tag').forEach(tag => {
                    tag.draggable = true;
                    
                    tag.addEventListener('dragstart', function(e) {
                        draggedElement = this;
                        this.style.opacity = '0.5';
                    });
                    
                    tag.addEventListener('dragend', function(e) {
                        this.style.opacity = '1';
                    });
                    
                    tag.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        const afterElement = getDragAfterElement(container, e.clientY);
                        if (afterElement == null) {
                            container.appendChild(draggedElement);
                        } else {
                            container.insertBefore(draggedElement, afterElement);
                        }
                    });
                });
            }
            
            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.custom-tag:not(.dragging)')];
                
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
            </script>

            <!-- SEGURIDAD -->
            <div id="tab-seguridad" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-shield-alt me-2"></i>Seguridad del Sistema</h3>
                    <p class="text-muted mb-4">Configure las políticas de seguridad y autenticación para proteger su sistema</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Seguridad Avanzada:</strong> Configure políticas de contraseñas, autenticación de dos factores, y monitoreo de actividades.
                    </div>
                    
                    {% set seguridad = config.get('seguridad', {}) %}
                    
                    <!-- Autenticación y Sesiones -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-user-shield section-icon"></i> Autenticación y Sesiones</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo de Sesión (minutos)</label>
                                <input type="number" name="tiempo_sesion" class="neo-input" 
                                       value="{{ seguridad.get('tiempo_sesion', 60) }}" min="5" max="480">
                                <small class="help-text">Después de este tiempo la sesión expira automáticamente</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Sesiones Concurrentes Máximas</label>
                                <input type="number" name="sesiones_concurrentes_max" class="neo-input" 
                                       value="{{ seguridad.get('sesiones_concurrentes_max', 2) }}" min="1">
                                <small class="help-text">Número máximo de sesiones simultáneas por usuario</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Intentos de Login Permitidos</label>
                                <input type="number" name="intentos_login" class="neo-input" 
                                       value="{{ seguridad.get('intentos_login', 5) }}" min="3" max="10">
                                <small class="help-text">Después de esto, la IP es bloqueada temporalmente</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo de Bloqueo de IP (minutos)</label>
                                <input type="number" name="tiempo_bloqueo_ip" class="neo-input" 
                                       value="{{ seguridad.get('tiempo_bloqueo_ip', 15) }}" min="5">
                                <small class="help-text">Tiempo que una IP queda bloqueada por intentos fallidos</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="cerrar_sesiones_concurrentes" 
                               {% if seguridad.get('cerrar_sesiones_concurrentes', True) %}checked{% endif %}>
                        <label><strong>Cerrar Sesiones Anteriores Automáticamente</strong></label>
                        <small class="help-text d-block">Cierra automáticamente otras sesiones cuando se alcanza el máximo concurrente</small>
                    </div>
                    
                    <!-- Políticas de Contraseñas -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-key section-icon"></i> Políticas de Contraseñas</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Longitud Mínima de Contraseña</label>
                                <input type="number" name="longitud_min_contraseña" class="neo-input" 
                                       value="{{ seguridad.get('longitud_min_contraseña', 8) }}" min="6" max="20">
                                <small class="help-text">Mínimo de caracteres requeridos</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Expiración de Contraseña (días)</label>
                                <input type="number" name="dias_expira_contraseña" class="neo-input" 
                                       value="{{ seguridad.get('dias_expira_contraseña', 90) }}" min="0" max="365">
                                <small class="help-text">0 = Sin expiración, obliga a cambiar cada X días</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="complejidad_contraseña" 
                               {% if seguridad.get('complejidad_contraseña', True) %}checked{% endif %}>
                        <label><strong>Complejidad de Contraseñas Requerida</strong></label>
                        <small class="help-text d-block">Requiere mayúsculas, minúsculas, números y símbolos</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="no_reusar_contraseñas" 
                               {% if seguridad.get('no_reusar_contraseñas', True) %}checked{% endif %}>
                        <label><strong>No Permitir Reutilizar Contraseñas</strong></label>
                        <small class="help-text d-block">Evita usar las últimas 5 contraseñas anteriores</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="expira_contraseña" 
                               {% if seguridad.get('expira_contraseña', False) %}checked{% endif %}>
                        <label><strong>Habilitar Expiración de Contraseñas</strong></label>
                        <small class="help-text d-block">Activa el sistema de expiración automática</small>
                    </div>
                    
                    <!-- Autenticación de Dos Factores (2FA) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-mobile-alt section-icon"></i> Autenticación de Dos Factores (2FA)</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="autenticacion_2fa" 
                               {% if seguridad.get('autenticacion_2fa', False) %}checked{% endif %}>
                        <label><strong>Habilitar 2FA para Todos los Usuarios</strong></label>
                        <small class="help-text d-block">Requiere código adicional para iniciar sesión</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="2fa_sms" 
                                       {% if seguridad.get('2fa_sms', True) %}checked{% endif %}>
                                <label>Permitir Códigos por SMS</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-checkbox">
                                <input type="checkbox" name="2fa_email" 
                                       {% if seguridad.get('2fa_email', True) %}checked{% endif %}>
                                <label>Permitir Códigos por Email</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Registro de Actividades (Security Audit Log) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-clipboard-list section-icon"></i> Registro de Actividades</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="registro_actividades" 
                               {% if seguridad.get('registro_actividades', True) %}checked{% endif %}>
                        <label><strong>Registrar Todas las Actividades de Seguridad</strong></label>
                        <small class="help-text d-block">Guarda logs de login, cambios de permisos, modificaciones de datos</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Retención de Logs (días)</label>
                                <input type="number" name="retencion_logs" class="neo-input" 
                                       value="{{ seguridad.get('retencion_logs', 90) }}" min="7" max="365">
                                <small class="help-text">Tiempo que se mantienen los logs de seguridad</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cifrado de Datos Sensibles -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-lock section-icon"></i> Cifrado de Datos</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="cifrar_datos_sensibles" 
                               {% if seguridad.get('cifrar_datos_sensibles', True) %}checked{% endif %}>
                        <label><strong>Cifrar Datos Sensibles (Tarjetas, RGPD)</strong></label>
                        <small class="help-text d-block">Protege información personal y datos de tarjetas</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="backups_cifrados" 
                               {% if seguridad.get('backups_cifrados', True) %}checked{% endif %}>
                        <label><strong>Cifrar Todos los Backups</strong></label>
                        <small class="help-text d-block">Todos los respaldos se guardan con cifrado AES-256</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="exportaciones_cifradas" 
                               {% if seguridad.get('exportaciones_cifradas', True) %}checked{% endif %}>
                        <label><strong>Exportaciones con Contraseña</strong></label>
                        <small class="help-text d-block">Las exportaciones de datos requieren contraseña para abrir</small>
                    </div>
                    
                    <!-- Backups Automáticos -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-cloud-download-alt section-icon"></i> Backups Automáticos</h5>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="backups_automaticos_seguridad" 
                               {% if seguridad.get('backups_automaticos_seguridad', True) %}checked{% endif %}>
                        <label><strong>Habilitar Backups Automáticos Diarios</strong></label>
                        <small class="help-text d-block">Respaldos automáticos cada 24 horas</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Días de Retención</label>
                                <input type="number" name="dias_retencion_backups" class="neo-input" 
                                       value="{{ seguridad.get('dias_retencion_backups', 30) }}" min="7" max="90">
                                <small class="help-text">Cuántos días mantener los backups</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Control de Acceso -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-network-wired section-icon"></i> Control de Acceso</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="bloqueo_ip_activo" 
                               {% if seguridad.get('bloqueo_ip_activo', False) %}checked{% endif %}>
                        <label><strong>Bloquear IPs Desconocidas</strong></label>
                        <small class="help-text d-block">Solo permite acceso desde IPs previamente registradas</small>
                    </div>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">IPs Permitidas (separadas por comas)</label>
                        <textarea name="ips_permitidas" class="neo-input" rows="3" 
                                  placeholder="192.168.1.100, 10.0.0.50">{{ seguridad.get('ips_permitidas', '') }}</textarea>
                        <small class="help-text">Deje vacío para permitir cualquier IP</small>
                    </div>
                    
                    <!-- Alertas de Seguridad -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-bell section-icon"></i> Alertas de Seguridad</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alertar_login_nuevo" 
                               {% if seguridad.get('alertar_login_nuevo', True) %}checked{% endif %}>
                        <label><strong>Notificar Nuevos Logins</strong></label>
                        <small class="help-text d-block">Envía email/SMS cuando alguien inicia sesión</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alertar_cambios_permisos" 
                               {% if seguridad.get('alertar_cambios_permisos', True) %}checked{% endif %}>
                        <label><strong>Notificar Cambios de Permisos</strong></label>
                        <small class="help-text d-block">Avisa cuando se modifican permisos de usuarios</small>
                    </div>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Canales de Alerta</label>
                        <div class="neo-checkbox">
                            <input type="checkbox" name="alertas_email" 
                                   {% if seguridad.get('alertas_email', True) %}checked{% endif %}>
                            <label>Email</label>
                        </div>
                        <div class="neo-checkbox">
                            <input type="checkbox" name="alertas_sms" 
                                   {% if seguridad.get('alertas_sms', False) %}checked{% endif %}>
                            <label>SMS</label>
                        </div>
                        <div class="neo-checkbox">
                            <input type="checkbox" name="alertas_whatsapp" 
                                   {% if seguridad.get('alertas_whatsapp', False) %}checked{% endif %}>
                            <label>WhatsApp</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VISUAL -->
            <div id="tab-visual" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-palette me-2"></i>Personalización Visual Completa</h3>
                    <p class="text-muted mb-4">Personalice completamente la apariencia, colores, tipografía, tema y estilo de su sistema</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-magic"></i> 
                        <strong>Personalización Total:</strong> Colores, tipografía, temas, densidad, animaciones, accesibilidad y más de 100 opciones configurables.
                    </div>
                    
                    {% set visual = config.get('visual', {}) %}
                    
                    <!-- TEMAS PREDEFINIDOS (4) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-paint-brush section-icon"></i> Temas Prediseñados</h5>
                    
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="neo-form-group">
                                <label class="neo-label">Tema Principal</label>
                                <select name="tema" class="neo-input" onchange="aplicarTemaPreview(this.value)">
                                    <option value="automatico" {% if visual.get('tema', 'automatico') == 'automatico' %}selected{% endif %}>🔄 Automático (sigue sistema)</option>
                                    <option value="claro" {% if visual.get('tema') == 'claro' %}selected{% endif %}>☀️ Claro</option>
                                    <option value="oscuro" {% if visual.get('tema') == 'oscuro' %}selected{% endif %}>🌙 Oscuro</option>
                                    <option value="alto_contraste" {% if visual.get('tema') == 'alto_contraste' %}selected{% endif %}>🔆 Alto Contraste</option>
                                    <option value="sepia" {% if visual.get('tema') == 'sepia' %}selected{% endif %}>📜 Sepia</option>
                                    <option value="cyber" {% if visual.get('tema') == 'cyber' %}selected{% endif %}>🤖 Cyber (verde neón)</option>
                                    <option value="formal" {% if visual.get('tema') == 'formal' %}selected{% endif %}>👔 Formal (azul profesional)</option>
                                    <option value="clasico" {% if visual.get('tema') == 'clasico' %}selected{% endif %}>🏛️ Clásico</option>
                                </select>
                                <small class="help-text">Seleccione un tema y personalice los colores a continuación</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="preview_tiempo_real" checked id="previewTiempoReal">
                        <label for="previewTiempoReal"><strong>Vista Previa en Tiempo Real</strong></label>
                        <small class="help-text d-block">Muestra los cambios visuales inmediatamente mientras configura</small>
                    </div>
                    
                    <!-- PALETA DE COLORES (1) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-palette section-icon"></i> Paleta de Colores</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Color Primario</label>
                                <input type="color" name="color_primario" class="neo-input" 
                                       value="{{ visual.get('color_primario', '#4f46e5') }}" 
                                       onchange="actualizarColorPrimario(this.value)">
                                <input type="text" class="neo-input mt-2" name="color_primario_hex" 
                                       value="{{ visual.get('color_primario', '#4f46e5') }}" 
                                       placeholder="#4f46e5" style="font-family: monospace;">
                                <small class="help-text">Color principal del sistema (botones, enlaces, acentos)</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Color Secundario</label>
                                <input type="color" name="color_secundario" class="neo-input" 
                                       value="{{ visual.get('color_secundario', '#7c3aed') }}">
                                <input type="text" class="neo-input mt-2" name="color_secundario_hex" 
                                       value="{{ visual.get('color_secundario', '#7c3aed') }}" 
                                       placeholder="#7c3aed" style="font-family: monospace;">
                                <small class="help-text">Color secundario (botones hover, elementos secundarios)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Color de Acentos</label>
                                <input type="color" name="color_acentos" class="neo-input" 
                                       value="{{ visual.get('color_acentos', '#10b981') }}">
                                <small class="help-text">Para highlights, badges, notificaciones</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Color de Fondos</label>
                                <input type="color" name="color_fondo" class="neo-input" 
                                       value="{{ visual.get('color_fondo', '#f9fafb') }}">
                                <small class="help-text">Color de fondo principal</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TIPOGRAFÍA (2, 16) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-font section-icon"></i> Tipografía</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Familia de Fuente</label>
                                <select name="familia_fuente" class="neo-input">
                                    <option value="roboto" {% if visual.get('familia_fuente') == 'roboto' %}selected{% endif %}>Roboto</option>
                                    <option value="inter" {% if visual.get('familia_fuente') == 'inter' %}selected{% endif %}>Inter</option>
                                    <option value="open_sans" {% if visual.get('familia_fuente') == 'open_sans' %}selected{% endif %}>Open Sans</option>
                                    <option value="lato" {% if visual.get('familia_fuente') == 'lato' %}selected{% endif %}>Lato</option>
                                    <option value="montserrat" {% if visual.get('familia_fuente') == 'montserrat' %}selected{% endif %}>Montserrat</option>
                                    <option value="poppins" {% if visual.get('familia_fuente', 'poppins') == 'poppins' %}selected{% endif %}>Poppins (Recomendada)</option>
                                    <option value="nunito" {% if visual.get('familia_fuente') == 'nunito' %}selected{% endif %}>Nunito</option>
                                    <option value="custom" {% if visual.get('familia_fuente') == 'custom' %}selected{% endif %}>Personalizada (subir archivo)</option>
                                </select>
                                <small class="help-text">Fuente que usará todo el sistema</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tamaño Base de Fuente</label>
                                <input type="number" name="tamano_fuente_base" class="neo-input" 
                                       value="{{ visual.get('tamano_fuente_base', 16) }}" min="12" max="20" step="1">
                                <small class="help-text">Tamaño base en pixels (12-20px)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Escala Móvil</label>
                                <input type="number" name="escala_movil" class="neo-input" 
                                       value="{{ visual.get('escala_movil', 1) }}" min="0.8" max="1.5" step="0.1">
                                <small class="help-text">Multiplicador para móviles</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Escala Tablet</label>
                                <input type="number" name="escala_tablet" class="neo-input" 
                                       value="{{ visual.get('escala_tablet', 1.1) }}" min="0.9" max="1.6" step="0.1">
                                <small class="help-text">Multiplicador para tablets</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Escala Desktop</label>
                                <input type="number" name="escala_desktop" class="neo-input" 
                                       value="{{ visual.get('escala_desktop', 1.2) }}" min="1" max="2" step="0.1">
                                <small class="help-text">Multiplicador para desktop</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Fuente Personalizada (opcional)</label>
                        <input type="file" name="fuente_personalizada" accept=".woff2,.woff,.ttf,.otf" class="neo-input">
                        <small class="help-text">Subir archivo de fuente personalizada (.woff2, .woff, .ttf, .otf)</small>
                    </div>
                    
                    <!-- DENSIDAD Y ESPACIADO (3) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-compress-arrows-alt section-icon"></i> Densidad y Espaciado</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Densidad de Información</label>
                        <select name="densidad" class="neo-input">
                            <option value="compacta" {% if visual.get('densidad') == 'compacta' %}selected{% endif %}>📦 Compacta (más información visible)</option>
                            <option value="normal" {% if visual.get('densidad', 'normal') == 'normal' %}selected{% endif %}>📄 Normal (balance ideal)</option>
                            <option value="espaciosa" {% if visual.get('densidad') == 'espaciosa' %}selected{% endif %}>📋 Espaciosa (fácil lectura)</option>
                        </select>
                        <small class="help-text">Controla el espaciado entre elementos y la densidad de información</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Altura de Filas de Tablas</label>
                                <input type="number" name="altura_filas" class="neo-input" 
                                       value="{{ visual.get('altura_filas', 48) }}" min="32" max="80" step="4">
                                <small class="help-text">Altura en pixels</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Padding General</label>
                                <input type="number" name="padding_general" class="neo-input" 
                                       value="{{ visual.get('padding_general', 16) }}" min="8" max="32" step="4">
                                <small class="help-text">Espaciado general en pixels</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Gap entre Cards</label>
                                <input type="number" name="gap_cards" class="neo-input" 
                                       value="{{ visual.get('gap_cards', 16) }}" min="0" max="32" step="4">
                                <small class="help-text">Espacio entre tarjetas</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ESTILO DE COMPONENTES (5) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-shapes section-icon"></i> Estilo de Componentes</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Bordes</label>
                                <select name="estilo_bordes" class="neo-input">
                                    <option value="redondeado" {% if visual.get('estilo_bordes', 'redondeado') == 'redondeado' %}selected{% endif %}>⭕ Redondeado</option>
                                    <option value="cuadrado" {% if visual.get('estilo_bordes') == 'cuadrado' %}selected{% endif %}>⬜ Cuadrado</option>
                                    <option value="muy_redondeado" {% if visual.get('estilo_bordes') == 'muy_redondeado' %}selected{% endif %}>🔵 Muy Redondeado</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Estilo de Botones</label>
                                <select name="estilo_botones" class="neo-input">
                                    <option value="filled" {% if visual.get('estilo_botones', 'filled') == 'filled' %}selected{% endif %}>🟦 Filled (sólido)</option>
                                    <option value="outlined" {% if visual.get('estilo_botones') == 'outlined' %}selected{% endif %}>⬜ Outlined (borde)</option>
                                    <option value="text" {% if visual.get('estilo_botones') == 'text' %}selected{% endif %}>📝 Text (solo texto)</option>
                                    <option value="neumorphic" {% if visual.get('estilo_botones') == 'neumorphic' %}selected{% endif %}>🎨 Neomorphic</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Estilo de Tarjetas</label>
                                <select name="estilo_tarjetas" class="neo-input">
                                    <option value="sombra" {% if visual.get('estilo_tarjetas', 'sombra') == 'sombra' %}selected{% endif %}>💫 Con Sombra</option>
                                    <option value="neumorphic" {% if visual.get('estilo_tarjetas') == 'neumorphic' %}selected{% endif %}>🎨 Neomorphic</option>
                                    <option value="plano" {% if visual.get('estilo_tarjetas') == 'plano' %}selected{% endif %}>📄 Plano (sin elevación)</option>
                                    <option value="borde" {% if visual.get('estilo_tarjetas') == 'borde' %}selected{% endif %}>📋 Con Borde</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- BARRA LATERAL (6) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-bars section-icon"></i> Barra Lateral (Sidebar)</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Ancho</label>
                                <select name="ancho_sidebar" class="neo-input">
                                    <option value="delgado" {% if visual.get('ancho_sidebar') == 'delgado' %}selected{% endif %}>📏 Delgado (200px)</option>
                                    <option value="normal" {% if visual.get('ancho_sidebar', 'normal') == 'normal' %}selected{% endif %}>📐 Normal (260px)</option>
                                    <option value="ancho" {% if visual.get('ancho_sidebar') == 'ancho' %}selected{% endif %}>📊 Ancho (320px)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Posición</label>
                                <select name="posicion_sidebar" class="neo-input">
                                    <option value="izquierda" {% if visual.get('posicion_sidebar', 'izquierda') == 'izquierda' %}selected{% endif %}>⬅️ Izquierda</option>
                                    <option value="derecha" {% if visual.get('posicion_sidebar') == 'derecha' %}selected{% endif %}>➡️ Derecha</option>
                                    <option value="superior" {% if visual.get('posicion_sidebar') == 'superior' %}selected{% endif %}>⬆️ Superior (Top Nav)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-checkbox" style="margin-top: 35px;">
                                <input type="checkbox" name="sidebar_colapsable" 
                                       {% if visual.get('sidebar_colapsable', True) %}checked{% endif %}>
                                <label>Es Colapsable</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ANIMACIONES (7) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-film section-icon"></i> Animaciones y Transiciones</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="animaciones_habilitadas" 
                               {% if visual.get('animaciones_habilitadas', True) %}checked{% endif %}>
                        <label><strong>Habilitar Animaciones</strong></label>
                        <small class="help-text d-block">Activa/desactiva todas las animaciones del sistema</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Velocidad de Animación</label>
                                <select name="velocidad_animacion" class="neo-input">
                                    <option value="lenta" {% if visual.get('velocidad_animacion') == 'lenta' %}selected{% endif %}>🐌 Lenta (300ms)</option>
                                    <option value="normal" {% if visual.get('velocidad_animacion', 'normal') == 'normal' %}selected{% endif %}>⚡ Normal (200ms)</option>
                                    <option value="rapida" {% if visual.get('velocidad_animacion') == 'rapida' %}selected{% endif %}>💨 Rápida (100ms)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tipo de Carga</label>
                                <select name="tipo_carga" class="neo-input">
                                    <option value="spinner" {% if visual.get('tipo_carga', 'spinner') == 'spinner' %}selected{% endif %}>🌀 Spinner</option>
                                    <option value="skeleton" {% if visual.get('tipo_carga') == 'skeleton' %}selected{% endif %}>💀 Skeleton</option>
                                    <option value="progress" {% if visual.get('tipo_carga') == 'progress' %}selected{% endif %}>📊 Progress Bar</option>
                                    <option value="pulsante" {% if visual.get('tipo_carga') == 'pulsante' %}selected{% endif %}>💓 Pulsante</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ACCESIBILIDAD (9) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-universal-access section-icon"></i> Accesibilidad</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alto_contraste" 
                               {% if visual.get('alto_contraste', False) %}checked{% endif %}>
                        <label><strong>Modo Alto Contraste</strong></label>
                        <small class="help-text d-block">Mayor contraste para mejor visibilidad</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="reducir_movimiento" 
                               {% if visual.get('reducir_movimiento', False) %}checked{% endif %}>
                        <label><strong>Reducir Movimiento</strong></label>
                        <small class="help-text d-block">Desactiva animaciones y movimientos (accesibilidad)</small>
                    </div>
                    
                    <!-- IDIOMAS (10) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-globe section-icon"></i> Idioma</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Idioma del Sistema</label>
                        <select name="idioma" class="neo-input">
                            <option value="es" {% if visual.get('idioma', 'es') == 'es' %}selected{% endif %}>🇪🇸 Español</option>
                            <option value="en" {% if visual.get('idioma') == 'en' %}selected{% endif %}>🇺🇸 English</option>
                            <option value="pt" {% if visual.get('idioma') == 'pt' %}selected{% endif %}>🇵🇹 Português</option>
                            <option value="fr" {% if visual.get('idioma') == 'fr' %}selected{% endif %}>🇫🇷 Français</option>
                            <option value="de" {% if visual.get('idioma') == 'de' %}selected{% endif %}>🇩🇪 Deutsch</option>
                            <option value="it" {% if visual.get('idioma') == 'it' %}selected{% endif %}>🇮🇹 Italiano</option>
                            <option value="ru" {% if visual.get('idioma') == 'ru' %}selected{% endif %}>🇷🇺 Русский</option>
                            <option value="zh" {% if visual.get('idioma') == 'zh' %}selected{% endif %}>🇨🇳 中文</option>
                            <option value="ja" {% if visual.get('idioma') == 'ja' %}selected{% endif %}>🇯🇵 日本語</option>
                        </select>
                        <small class="help-text">Seleccione el idioma para toda la interfaz</small>
                    </div>
                    
                    <!-- LOGO (11) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-image section-icon"></i> Logo Personalizado</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Subir Logo</label>
                        <input type="file" name="logo_personalizado" accept="image/*" class="neo-input">
                        <small class="help-text">PNG, JPG, SVG (tamaño recomendado: 200x60px)</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Posición del Logo</label>
                                <select name="posicion_logo" class="neo-input">
                                    <option value="esquina" {% if visual.get('posicion_logo', 'esquina') == 'esquina' %}selected{% endif %}>📌 Esquina</option>
                                    <option value="centrado" {% if visual.get('posicion_logo') == 'centrado' %}selected{% endif %}>📍 Centrado</option>
                                    <option value="derecha" {% if visual.get('posicion_logo') == 'derecha' %}selected{% endif %}>▶️ Derecha</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tamaño del Logo (%)</label>
                                <input type="number" name="tamano_logo" class="neo-input" 
                                       value="{{ visual.get('tamano_logo', 100) }}" min="50" max="200" step="10">
                                <small class="help-text">50% a 200% del tamaño original</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RESPONSIVE (8) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-mobile-alt section-icon"></i> Adaptación Responsive</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="sidebar_movil" 
                               {% if visual.get('sidebar_movil', True) %}checked{% endif %}>
                        <label><strong>Sidebar Flotante en Móvil</strong></label>
                        <small class="help-text d-block">La barra lateral se convierte en menú deslizable en móviles</small>
                    </div>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Punto de Quiebre para Desktop (px)</label>
                        <input type="number" name="breakpoint_desktop" class="neo-input" 
                               value="{{ visual.get('breakpoint_desktop', 1024) }}" min="768" max="1400">
                        <small class="help-text">Ancho mínimo para activar diseño desktop</small>
                    </div>
                    
                    <!-- GRADIENTES (19) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-layer-group section-icon"></i> Gradientes y Efectos</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="gradiente_fondo" 
                               {% if visual.get('gradiente_fondo', False) %}checked{% endif %}>
                        <label><strong>Fondo con Gradiente</strong></label>
                        <small class="help-text d-block">Aplica un gradiente al fondo del sistema</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Color Inicial del Gradiente</label>
                                <input type="color" name="gradiente_color_inicio" class="neo-input" 
                                       value="{{ visual.get('gradiente_color_inicio', '#667eea') }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Color Final del Gradiente</label>
                                <input type="color" name="gradiente_color_fin" class="neo-input" 
                                       value="{{ visual.get('gradiente_color_fin', '#764ba2') }}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Dirección del Gradiente</label>
                        <select name="gradiente_direccion" class="neo-input">
                            <option value="horizontal" {% if visual.get('gradiente_direccion') == 'horizontal' %}selected{% endif %}>➡️ Horizontal</option>
                            <option value="vertical" {% if visual.get('gradiente_direccion', 'vertical') == 'vertical' %}selected{% endif %}>⬇️ Vertical</option>
                            <option value="diagonal" {% if visual.get('gradiente_direccion') == 'diagonal' %}selected{% endif %}>↘️ Diagonal</option>
                            <option value="radial" {% if visual.get('gradiente_direccion') == 'radial' %}selected{% endif %}>⭕ Radial</option>
                        </select>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="efecto_glassmorphism" 
                               {% if visual.get('efecto_glassmorphism', False) %}checked{% endif %}>
                        <label><strong>Efecto Glassmorphism</strong></label>
                        <small class="help-text d-block">Bordes translúcidos con blur (efecto moderno)</small>
                    </div>
                    
                    <!-- GUARDAR Y EXPORTAR (14) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-download section-icon"></i> Guardar y Exportar Configuración</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <button type="button" class="btn btn-info" onclick="exportarTema()">
                                <i class="fas fa-file-export"></i> Exportar Tema
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-secondary" onclick="importarTema()">
                                <i class="fas fa-file-import"></i> Importar Tema
                            </button>
                        </div>
                    </div>
                    
                    <div class="neo-form-group">
                        <label class="neo-label">Nombre del Tema Personalizado</label>
                        <input type="text" name="nombre_tema" class="neo-input" 
                               value="{{ visual.get('nombre_tema', 'Mi Tema Personalizado') }}" 
                               placeholder="Ej: Tema Corporativo 2024">
                        <small class="help-text">Guarde su configuración visual con un nombre</small>
                    </div>
                    
                    <!-- VISTA PREVIA (13) -->
                    <div class="mt-4 p-3" style="background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                        <h6 class="mb-3"><i class="fas fa-eye"></i> Vista Previa</h6>
                        <div id="vistaPrevisual" style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <div class="btn btn-primary">Botón Primario</div>
                            <div class="btn btn-secondary">Botón Secundario</div>
                            <div class="btn btn-success">Éxito</div>
                            <div class="btn btn-danger">Peligro</div>
                        </div>
                        <div class="mt-3">
                            <div class="alert alert-info">Este es un ejemplo de alerta de información</div>
                            <div class="alert alert-warning">Este es un ejemplo de alerta de advertencia</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
            function aplicarTemaPreview(tema) {
                console.log('Aplicando tema:', tema);
                // Aquí se puede agregar lógica para cambiar colores automáticamente
            }
            
            function actualizarColorPrimario(color) {
                document.querySelector('input[name="color_primario_hex"]').value = color;
                if (document.getElementById('previewTiempoReal').checked) {
                    document.documentElement.style.setProperty('--color-primario', color);
                }
            }
            
            function exportarTema() {
                const tema = {
                    nombre: document.querySelector('input[name="nombre_tema"]').value,
                    fecha: new Date().toISOString(),
                    configuracion: {}
                };
                const blob = new Blob([JSON.stringify(tema, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tema_personalizado.json';
                a.click();
                URL.revokeObjectURL(url);
            }
            
            function importarTema() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'application/json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            try {
                                const tema = JSON.parse(event.target.result);
                                alert('Tema importado: ' + tema.nombre);
                                // Aquí cargar las configuraciones del tema
                            } catch (error) {
                                alert('Error al importar el tema');
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            }
            </script>

            <!-- INVENTARIO -->
            <div id="tab-inventario" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-boxes me-2"></i>Gestión Avanzada de Inventario</h3>
                    <p class="text-muted mb-4">Configure el control completo de stock, códigos de barras, seriales, ubicaciones y más</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Inventario Inteligente:</strong> Control de stock avanzado, códigos de barras, seriales, ubicaciones múltiples y alertas automáticas.
                    </div>
                    
                    {% set inventario = config.get('inventario', {}) %}
                    
                    <!-- CONTROL DE STOCK AVANZADO (1) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-chart-line section-icon"></i> Control de Stock Avanzado</h5>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="control_stock" 
                               {% if inventario.get('control_stock', True) %}checked{% endif %}>
                        <label><strong>Habilitar Control de Stock</strong></label>
                        <small class="help-text d-block">Activa el sistema completo de gestión de inventario</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Stock Mínimo por Defecto</label>
                                <input type="number" name="stock_minimo_default" class="neo-input" 
                                       value="{{ inventario.get('stock_minimo_default', 5) }}" min="0">
                                <small class="help-text">Cantidad mínima antes de alertar</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Stock Máximo por Defecto</label>
                                <input type="number" name="stock_maximo_default" class="neo-input" 
                                       value="{{ inventario.get('stock_maximo_default', 100) }}" min="1">
                                <small class="help-text">Cantidad máxima recomendada</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Punto de Reorden</label>
                                <input type="number" name="punto_reorden_default" class="neo-input" 
                                       value="{{ inventario.get('punto_reorden_default', 10) }}" min="1">
                                <small class="help-text">Cantidad para sugerir compra</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="alertas_stock_critico" 
                               {% if inventario.get('alertas_stock_critico', True) %}checked{% endif %}>
                        <label><strong>Alertas por Stock Crítico</strong></label>
                        <small class="help-text d-block">Notifica cuando el stock está por debajo del mínimo</small>
                    </div>
                    
                    <!-- CÓDIGOS DE BARRAS Y QR (2) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-barcode section-icon"></i> Códigos de Barras y QR</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="codigos_barras" 
                               {% if inventario.get('codigos_barras', False) %}checked{% endif %}>
                        <label><strong>Habilitar Códigos de Barras</strong></label>
                        <small class="help-text d-block">Genera y gestiona códigos de barras para productos</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Formato de Código</label>
                                <select name="formato_codigo_barras" class="neo-input">
                                    <option value="EAN13" {% if inventario.get('formato_codigo_barras') == 'EAN13' %}selected{% endif %}>EAN-13 (Recomendado)</option>
                                    <option value="UPC" {% if inventario.get('formato_codigo_barras') == 'UPC' %}selected{% endif %}>UPC</option>
                                    <option value="Code128" {% if inventario.get('formato_codigo_barras', 'Code128') == 'Code128' %}selected{% endif %}>Code 128</option>
                                    <option value="QR" {% if inventario.get('formato_codigo_barras') == 'QR' %}selected{% endif %}>QR Code</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-checkbox" style="margin-top: 35px;">
                                <input type="checkbox" name="generacion_automatica_codigos" 
                                       {% if inventario.get('generacion_automatica_codigos', True) %}checked{% endif %}>
                                <label>Generación Automática</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="impresion_masiva_etiquetas" 
                               {% if inventario.get('impresion_masiva_etiquetas', False) %}checked{% endif %}>
                        <label><strong>Impresión Masiva de Etiquetas</strong></label>
                        <small class="help-text d-block">Permite imprimir etiquetas en lotes</small>
                    </div>
                    
                    <!-- CONTROL DE SERIALES Y LOTES (3) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-tags section-icon"></i> Control de Seriales y Lotes</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="seriales" 
                               {% if inventario.get('seriales', True) %}checked{% endif %}>
                        <label><strong>Control de Seriales</strong></label>
                        <small class="help-text d-block">Rastrea productos por número de serie único</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="control_lotes" 
                               {% if inventario.get('control_lotes', False) %}checked{% endif %}>
                        <label><strong>Control de Lotes</strong></label>
                        <small class="help-text d-block">Gestiona productos por lotes con fechas</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="trazabilidad_completa" 
                               {% if inventario.get('trazabilidad_completa', True) %}checked{% endif %}>
                        <label><strong>Trazabilidad Completa</strong></label>
                        <small class="help-text d-block">Historial completo de movimientos por producto</small>
                    </div>
                    
                    <!-- UBICACIONES MÚLTIPLES (4) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-map-marker-alt section-icon"></i> Ubicaciones Múltiples</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="ubicaciones_multiples" 
                               {% if inventario.get('ubicaciones_multiples', False) %}checked{% endif %}>
                        <label><strong>Habilitar Ubicaciones Múltiples</strong></label>
                        <small class="help-text d-block">Permite gestionar múltiples almacenes y ubicaciones</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Almacenes por Defecto</label>
                                <textarea name="almacenes_default" class="neo-input" rows="3" 
                                          placeholder="Almacén Principal, Bodega Secundaria, Depósito">{{ inventario.get('almacenes_default', '') }}</textarea>
                                <small class="help-text">Separados por comas</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-checkbox" style="margin-top: 35px;">
                                <input type="checkbox" name="transferencias_entre_ubicaciones" 
                                       {% if inventario.get('transferencias_entre_ubicaciones', True) %}checked{% endif %}>
                                <label>Transferencias entre Ubicaciones</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GESTIÓN DE PROVEEDORES (5) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-truck section-icon"></i> Gestión de Proveedores</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="catalogo_proveedores" 
                               {% if inventario.get('catalogo_proveedores', False) %}checked{% endif %}>
                        <label><strong>Catálogo de Proveedores</strong></label>
                        <small class="help-text d-block">Mantiene información detallada de proveedores</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo de Entrega Promedio (días)</label>
                                <input type="number" name="tiempo_entrega_promedio" class="neo-input" 
                                       value="{{ inventario.get('tiempo_entrega_promedio', 7) }}" min="1">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-checkbox" style="margin-top: 35px;">
                                <input type="checkbox" name="evaluacion_proveedores" 
                                       {% if inventario.get('evaluacion_proveedores', False) %}checked{% endif %}>
                                <label>Evaluación de Proveedores</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CONTROL DE CADUCIDAD (6) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-calendar-times section-icon"></i> Control de Caducidad</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="control_caducidad" 
                               {% if inventario.get('control_caducidad', False) %}checked{% endif %}>
                        <label><strong>Habilitar Control de Caducidad</strong></label>
                        <small class="help-text d-block">Gestiona fechas de vencimiento de productos</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Días de Alerta de Caducidad</label>
                                <input type="number" name="dias_alerta_caducidad" class="neo-input" 
                                       value="{{ inventario.get('dias_alerta_caducidad', 30) }}" min="1">
                                <small class="help-text">Días antes del vencimiento para alertar</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Método de Rotación</label>
                                <select name="metodo_rotacion" class="neo-input">
                                    <option value="FIFO" {% if inventario.get('metodo_rotacion', 'FIFO') == 'FIFO' %}selected{% endif %}>FIFO (Primero en Entrar, Primero en Salir)</option>
                                    <option value="LIFO" {% if inventario.get('metodo_rotacion') == 'LIFO' %}selected{% endif %}>LIFO (Último en Entrar, Primero en Salir)</option>
                                    <option value="FEFO" {% if inventario.get('metodo_rotacion') == 'FEFO' %}selected{% endif %}>FEFO (Primero en Vencer, Primero en Salir)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- MOVIMIENTOS DE INVENTARIO (7) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-exchange-alt section-icon"></i> Movimientos de Inventario</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="causas_movimiento" 
                               {% if inventario.get('causas_movimiento', True) %}checked{% endif %}>
                        <label><strong>Registrar Causas de Movimiento</strong></label>
                        <small class="help-text d-block">Obliga a especificar el motivo de cada movimiento</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="aprobaciones_movimiento" 
                               {% if inventario.get('aprobaciones_movimiento', False) %}checked{% endif %}>
                        <label><strong>Aprobaciones por Rol</strong></label>
                        <small class="help-text d-block">Requiere aprobación para ciertos movimientos</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="historial_detallado" 
                               {% if inventario.get('historial_detallado', True) %}checked{% endif %}>
                        <label><strong>Historial Detallado</strong></label>
                        <small class="help-text d-block">Mantiene registro completo de todos los movimientos</small>
                    </div>
                    
                    <!-- COSTOS Y PRECIOS (8) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-dollar-sign section-icon"></i> Costos y Precios</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Método de Costeo</label>
                        <select name="metodo_costeo" class="neo-input">
                            <option value="promedio_ponderado" {% if inventario.get('metodo_costeo', 'promedio_ponderado') == 'promedio_ponderado' %}selected{% endif %}>Promedio Ponderado</option>
                            <option value="ultimo_costo" {% if inventario.get('metodo_costeo') == 'ultimo_costo' %}selected{% endif %}>Último Costo</option>
                            <option value="fifo" {% if inventario.get('metodo_costeo') == 'fifo' %}selected{% endif %}>FIFO (Primero en Entrar)</option>
                            <option value="lifo" {% if inventario.get('metodo_costeo') == 'lifo' %}selected{% endif %}>LIFO (Último en Entrar)</option>
                        </select>
                        <small class="help-text">Método para calcular el costo de inventario</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="precios_por_cliente" 
                               {% if inventario.get('precios_por_cliente', False) %}checked{% endif %}>
                        <label><strong>Precios por Cliente/Categoría</strong></label>
                        <small class="help-text d-block">Permite establecer precios diferenciados</small>
                    </div>
                    
                    <!-- ALERTAS Y NOTIFICACIONES (9) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-bell section-icon"></i> Alertas y Notificaciones</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alertas_stock_minimo" 
                               {% if inventario.get('alertas_stock_minimo', True) %}checked{% endif %}>
                        <label><strong>Alertas de Stock Mínimo</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alertas_caducidad" 
                               {% if inventario.get('alertas_caducidad', True) %}checked{% endif %}>
                        <label><strong>Alertas de Caducidad</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="alertas_movimientos_inusuales" 
                               {% if inventario.get('alertas_movimientos_inusuales', False) %}checked{% endif %}>
                        <label><strong>Alertas de Movimientos Inusuales</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="reportes_automaticos" 
                               {% if inventario.get('reportes_automaticos', False) %}checked{% endif %}>
                        <label><strong>Reportes Automáticos</strong></label>
                        <small class="help-text d-block">Envía reportes periódicos por email</small>
                    </div>
                    
                    <!-- INTEGRACIÓN CON COMPRAS (10) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-shopping-cart section-icon"></i> Integración con Compras</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="ordenes_compra_automaticas" 
                               {% if inventario.get('ordenes_compra_automaticas', False) %}checked{% endif %}>
                        <label><strong>Órdenes de Compra Automáticas</strong></label>
                        <small class="help-text d-block">Genera órdenes cuando se alcanza el punto de reorden</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="sugerencias_reposicion" 
                               {% if inventario.get('sugerencias_reposicion', True) %}checked{% endif %}>
                        <label><strong>Sugerencias de Reposición</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="comparacion_precios" 
                               {% if inventario.get('comparacion_precios', False) %}checked{% endif %}>
                        <label><strong>Comparación de Precios</strong></label>
                        <small class="help-text d-block">Compara precios entre proveedores</small>
                    </div>
                    
                    <!-- REPORTES AVANZADOS (11) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-chart-bar section-icon"></i> Reportes Avanzados</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="rotacion_inventario" 
                               {% if inventario.get('rotacion_inventario', True) %}checked{% endif %}>
                        <label><strong>Análisis de Rotación de Inventario</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="analisis_abc" 
                               {% if inventario.get('analisis_abc', True) %}checked{% endif %}>
                        <label><strong>Análisis ABC de Productos</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="tendencias_inventario" 
                               {% if inventario.get('tendencias_inventario', False) %}checked{% endif %}>
                        <label><strong>Análisis de Tendencias</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="exportacion_reportes" 
                               {% if inventario.get('exportacion_reportes', True) %}checked{% endif %}>
                        <label><strong>Exportación a Excel/PDF</strong></label>
                    </div>
                    
                    <!-- CONFIGURACIÓN DE CATEGORÍAS (12) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-layer-group section-icon"></i> Configuración de Categorías</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="categorias_personalizables" 
                               {% if inventario.get('categorias_personalizables', True) %}checked{% endif %}>
                        <label><strong>Categorías Personalizables</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="subcategorias" 
                               {% if inventario.get('subcategorias', False) %}checked{% endif %}>
                        <label><strong>Subcategorías</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="plantillas_productos" 
                               {% if inventario.get('plantillas_productos', False) %}checked{% endif %}>
                        <label><strong>Plantillas de Productos</strong></label>
                        <small class="help-text d-block">Plantillas predefinidas por categoría</small>
                    </div>
                    
                    <!-- CONTROL DE CALIDAD (13) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-check-circle section-icon"></i> Control de Calidad</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="inspecciones_recepcion" 
                               {% if inventario.get('inspecciones_recepcion', False) %}checked{% endif %}>
                        <label><strong>Inspecciones de Recepción</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="certificados_calidad" 
                               {% if inventario.get('certificados_calidad', False) %}checked{% endif %}>
                        <label><strong>Certificados de Calidad</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="productos_defectuosos" 
                               {% if inventario.get('productos_defectuosos', True) %}checked{% endif %}>
                        <label><strong>Control de Productos Defectuosos</strong></label>
                    </div>
                    
                    <!-- INVENTARIO FÍSICO (14) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-clipboard-check section-icon"></i> Inventario Físico</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="conteos_ciclicos" 
                               {% if inventario.get('conteos_ciclicos', False) %}checked{% endif %}>
                        <label><strong>Conteos Cíclicos</strong></label>
                        <small class="help-text d-block">Conteos programados por categoría</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="auditorias_programadas" 
                               {% if inventario.get('auditorias_programadas', False) %}checked{% endif %}>
                        <label><strong>Auditorías Programadas</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="ajustes_automaticos" 
                               {% if inventario.get('ajustes_automaticos', False) %}checked{% endif %}>
                        <label><strong>Ajustes Automáticos</strong></label>
                        <small class="help-text d-block">Ajusta diferencias menores automáticamente</small>
                    </div>
                    
                    <!-- CONFIGURACIÓN DE UNIDADES (15) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-ruler section-icon"></i> Configuración de Unidades</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="unidades_multiples" 
                               {% if inventario.get('unidades_multiples', False) %}checked{% endif %}>
                        <label><strong>Unidades de Medida Múltiples</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="conversiones_automaticas" 
                               {% if inventario.get('conversiones_automaticas', True) %}checked{% endif %}>
                        <label><strong>Conversiones Automáticas</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="empaques_presentaciones" 
                               {% if inventario.get('empaques_presentaciones', False) %}checked{% endif %}>
                        <label><strong>Empaques y Presentaciones</strong></label>
                    </div>
                    
                    <!-- ETIQUETAS Y CÓDIGOS (16) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-tag section-icon"></i> Etiquetas y Códigos</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="etiquetas_personalizables" 
                               {% if inventario.get('etiquetas_personalizables', False) %}checked{% endif %}>
                        <label><strong>Diseño de Etiquetas Personalizable</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="codigos_qr_informacion" 
                               {% if inventario.get('codigos_qr_informacion', False) %}checked{% endif %}>
                        <label><strong>Códigos QR con Información</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="etiquetas_ubicacion" 
                               {% if inventario.get('etiquetas_ubicacion', False) %}checked{% endif %}>
                        <label><strong>Etiquetas de Ubicación</strong></label>
                    </div>
                    
                    <!-- BACKUP DE INVENTARIO (17) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-cloud-upload-alt section-icon"></i> Backup de Inventario</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="backups_automaticos_inventario" 
                               {% if inventario.get('backups_automaticos_inventario', True) %}checked{% endif %}>
                        <label><strong>Respaldos Automáticos</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="sincronizacion_nube" 
                               {% if inventario.get('sincronizacion_nube', False) %}checked{% endif %}>
                        <label><strong>Sincronización en la Nube</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="historial_cambios" 
                               {% if inventario.get('historial_cambios', True) %}checked{% endif %}>
                        <label><strong>Historial de Cambios</strong></label>
                    </div>
                    
                    <!-- PERMISOS POR USUARIO (18) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-user-shield section-icon"></i> Permisos por Usuario</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="acceso_por_modulo" 
                               {% if inventario.get('acceso_por_modulo', True) %}checked{% endif %}>
                        <label><strong>Acceso por Módulo</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="aprobaciones_requeridas" 
                               {% if inventario.get('aprobaciones_requeridas', False) %}checked{% endif %}>
                        <label><strong>Aprobaciones Requeridas</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="roles_inventario" 
                               {% if inventario.get('roles_inventario', True) %}checked{% endif %}>
                        <label><strong>Roles de Inventario</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="auditoria_cambios" 
                               {% if inventario.get('auditoria_cambios', True) %}checked{% endif %}>
                        <label><strong>Auditoría de Cambios</strong></label>
                    </div>
                    
                    <!-- INTEGRACIÓN CON VENTAS (19) -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-handshake section-icon"></i> Integración con Ventas</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="reserva_stock" 
                               {% if inventario.get('reserva_stock', True) %}checked{% endif %}>
                        <label><strong>Reserva de Stock</strong></label>
                        <small class="help-text d-block">Reserva productos al crear órdenes</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="backorders" 
                               {% if inventario.get('backorders', False) %}checked{% endif %}>
                        <label><strong>Backorders</strong></label>
                        <small class="help-text d-block">Permite órdenes sin stock disponible</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="disponibilidad_tiempo_real" 
                               {% if inventario.get('disponibilidad_tiempo_real', True) %}checked{% endif %}>
                        <label><strong>Disponibilidad en Tiempo Real</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="sincronizacion_automatica" 
                               {% if inventario.get('sincronizacion_automatica', True) %}checked{% endif %}>
                        <label><strong>Sincronización Automática</strong></label>
                        <small class="help-text d-block">Actualiza stock automáticamente con las ventas</small>
                    </div>
                </div>
            </div>

            <!-- PROVEEDORES -->
            <div id="tab-proveedores" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-truck me-2"></i>Gestión de Proveedores</h3>
                    <p class="text-muted mb-4">Configure las políticas y parámetros para la gestión de proveedores</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Gestión Completa de Proveedores:</strong> Configure términos de pago, políticas de compra, evaluación y reportes automáticos.
                    </div>
                    
                    {% set proveedores_config = config.get('proveedores', {}) %}
                    
                    <!-- CONFIGURACIÓN GENERAL -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-cog section-icon"></i> Configuración General</h5>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="proveedores_habilitado" 
                               {% if proveedores_config.get('habilitado', False) %}checked{% endif %}>
                        <label><strong>Habilitar Gestión de Proveedores</strong></label>
                        <small class="help-text d-block">Activa el sistema completo de proveedores</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="proveedores_requerido" 
                               {% if proveedores_config.get('proveedor_requerido', False) %}checked{% endif %}>
                        <label><strong>Proveedor Requerido en Productos</strong></label>
                        <small class="help-text d-block">Obliga a especificar un proveedor al crear productos</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="proveedores_codigo_propio" 
                               {% if proveedores_config.get('codigo_propio_requerido', False) %}checked{% endif %}>
                        <label><strong>Código Propio de Proveedor</strong></label>
                        <small class="help-text d-block">Permite que cada proveedor tenga su propio sistema de códigos</small>
                    </div>
                    
                    <!-- TÉRMINOS DE PAGO -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-handshake section-icon"></i> Términos de Pago</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Términos de Pago por Defecto (días)</label>
                                <input type="number" name="proveedores_terminos_pago" class="neo-input" 
                                       value="{{ proveedores_config.get('terminos_pago', 30) }}" min="0" max="180">
                                <small class="help-text">Días para pagar facturas de proveedores</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Descuento por Pronto Pago (%)</label>
                                <input type="number" name="proveedores_descuento_pronto_pago" class="neo-input" 
                                       value="{{ proveedores_config.get('descuento_pronto_pago', 0) }}" min="0" max="100" step="0.5">
                                <small class="help-text">Descuento si se paga antes del plazo</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Recargo por Pago Tardío (%)</label>
                                <input type="number" name="proveedores_recargo_tardio" class="neo-input" 
                                       value="{{ proveedores_config.get('recargo_tardio', 0) }}" min="0" max="50" step="0.5">
                                <small class="help-text">Recargo adicional por pagos fuera de término</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Forma de Pago Favorita</label>
                                <select name="proveedores_forma_pago" class="neo-input">
                                    <option value="transferencia" {% if proveedores_config.get('forma_pago') == 'transferencia' %}selected{% endif %}>Transferencia</option>
                                    <option value="efectivo" {% if proveedores_config.get('forma_pago') == 'efectivo' %}selected{% endif %}>Efectivo</option>
                                    <option value="cheque" {% if proveedores_config.get('forma_pago') == 'cheque' %}selected{% endif %}>Cheque</option>
                                    <option value="credito" {% if proveedores_config.get('forma_pago') == 'credito' %}selected{% endif %}>Crédito Comercial</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PLAZOS DE ENTREGA -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-clock section-icon"></i> Plazos de Entrega</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo de Entrega Promedio (días)</label>
                                <input type="number" name="proveedores_plazos_entrega" class="neo-input" 
                                       value="{{ proveedores_config.get('plazos_entrega', 7) }}" min="1" max="30">
                                <small class="help-text">Tiempo promedio de entrega</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo de Entrega Urgente (días)</label>
                                <input type="number" name="proveedores_entrega_urgente" class="neo-input" 
                                       value="{{ proveedores_config.get('entrega_urgente', 2) }}" min="1" max="7">
                                <small class="help-text">Días para entregas urgentes con costo adicional</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Costo de Envío Promedio (USD)</label>
                        <input type="number" name="proveedores_costo_envio" class="neo-input" 
                               value="{{ proveedores_config.get('costo_envio', 0) }}" min="0" step="0.01">
                        <small class="help-text">Costo promedio de envío</small>
                    </div>
                    
                    <!-- EVALUACIÓN DE PROVEEDORES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-star section-icon"></i> Evaluación de Proveedores</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_evaluacion_automatica" 
                               {% if proveedores_config.get('evaluacion_automatica', False) %}checked{% endif %}>
                        <label><strong>Evaluación Automática</strong></label>
                        <small class="help-text d-block">Evalúa proveedores basado en entregas y tiempos</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Umbral de Calificación Mínima</label>
                                <input type="number" name="proveedores_umbral_calificacion" class="neo-input" 
                                       value="{{ proveedores_config.get('umbral_calificacion', 3) }}" min="0" max="5" step="0.5">
                                <small class="help-text">Calificación mínima para mantener activo</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Criterio de Puntualidad (%)</label>
                                <input type="number" name="proveedores_puntualidad_min" class="neo-input" 
                                       value="{{ proveedores_config.get('puntualidad_min', 80) }}" min="0" max="100">
                                <small class="help-text">% de entregas a tiempo requerido</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="neo-form-group">
                                <label class="neo-label">Criterio de Calidad (%)</label>
                                <input type="number" name="proveedores_calidad_min" class="neo-input" 
                                       value="{{ proveedores_config.get('calidad_min', 85) }}" min="0" max="100">
                                <small class="help-text">% de productos sin defectos requerido</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- POLÍTICAS DE COMPRA -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-shopping-cart section-icon"></i> Políticas de Compra</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_cotizaciones_multiples" 
                               {% if proveedores_config.get('cotizaciones_multiples', True) %}checked{% endif %}>
                        <label><strong>Requerir Cotizaciones Múltiples</strong></label>
                        <small class="help-text d-block">Solicita cotizaciones de al menos 3 proveedores</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_aprobacion_compras" 
                               {% if proveedores_config.get('aprobacion_compras', False) %}checked{% endif %}>
                        <label><strong>Aprobación Requerida para Compras</strong></label>
                        <small class="help-text d-block">Las órdenes requieren aprobación de supervisor</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Monto Mínimo para Cotización (USD)</label>
                                <input type="number" name="proveedores_monto_min_cotizacion" class="neo-input" 
                                       value="{{ proveedores_config.get('monto_min_cotizacion', 100) }}" min="0">
                                <small class="help-text">Requiere cotización si el monto es mayor</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Monto Máximo sin Aprobación (USD)</label>
                                <input type="number" name="proveedores_monto_max_sin_aprobacion" class="neo-input" 
                                       value="{{ proveedores_config.get('monto_max_sin_aprobacion', 500) }}" min="0">
                                <small class="help-text">Órdenes menores a este monto no requieren aprobación</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GARANTÍAS Y DEVOLUCIONES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-shield-alt section-icon"></i> Garantías y Devoluciones</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Política de Garantía (días)</label>
                                <input type="number" name="proveedores_politica_garantia" class="neo-input" 
                                       value="{{ proveedores_config.get('politica_garantia', 30) }}" min="0" max="365">
                                <small class="help-text">Días de garantía estándar</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Plazo para Devoluciones (días)</label>
                                <input type="number" name="proveedores_plazo_devolucion" class="neo-input" 
                                       value="{{ proveedores_config.get('plazo_devolucion', 7) }}" min="0" max="30">
                                <small class="help-text">Días para devolver productos defectuosos</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="proveedores_reembolso" 
                               {% if proveedores_config.get('reembolso_automatico', False) %}checked{% endif %}>
                        <label><strong>Reembolso Automático</strong></label>
                        <small class="help-text d-block">Aplica reembolso automático en devoluciones</small>
                    </div>
                    
                    <!-- COMUNICACIÓN CON PROVEEDORES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-comments section-icon"></i> Comunicación con Proveedores</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_notificaciones_email" 
                               {% if proveedores_config.get('notificaciones_email', True) %}checked{% endif %}>
                        <label><strong>Notificaciones por Email</strong></label>
                        <small class="help-text d-block">Envía órdenes y actualizaciones por email</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_notificaciones_whatsapp" 
                               {% if proveedores_config.get('notificaciones_whatsapp', False) %}checked{% endif %}>
                        <label><strong>Notificaciones por WhatsApp</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="proveedores_alertas_stock" 
                               {% if proveedores_config.get('alertas_stock_bajo', False) %}checked{% endif %}>
                        <label><strong>Alertar Proveedores por Stock Bajo</strong></label>
                        <small class="help-text d-block">Notifica a proveedores cuando el stock está bajo</small>
                    </div>
                    
                    <!-- REPORTES Y ANALÍTICAS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-chart-line section-icon"></i> Reportes y Analíticas</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_reportes_compras" 
                               {% if proveedores_config.get('reportes_compras', True) %}checked{% endif %}>
                        <label><strong>Reporte de Compras Mensuales</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_analisis_rendimiento" 
                               {% if proveedores_config.get('analisis_rendimiento', True) %}checked{% endif %}>
                        <label><strong>Análisis de Rendimiento de Proveedores</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_ranking_proveedores" 
                               {% if proveedores_config.get('ranking_proveedores', True) %}checked{% endif %}>
                        <label><strong>Ranking de Proveedores</strong></label>
                        <small class="help-text d-block">Clasifica proveedores por mejor desempeño</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="proveedores_comparacion_precios" 
                               {% if proveedores_config.get('comparacion_precios', True) %}checked{% endif %}>
                        <label><strong>Comparación de Precios entre Proveedores</strong></label>
                    </div>
                    
                    <!-- CATÁLOGO DE PROVEEDORES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-book section-icon"></i> Catálogo de Proveedores</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_catalogo_publico" 
                               {% if proveedores_config.get('catalogo_publico', False) %}checked{% endif %}>
                        <label><strong>Catálogo Público</strong></label>
                        <small class="help-text d-block">Permite a proveedores mantener su catálogo actualizado</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="proveedores_sincronizacion_precios" 
                               {% if proveedores_config.get('sincronizacion_precios', False) %}checked{% endif %}>
                        <label><strong>Sincronización Automática de Precios</strong></label>
                        <small class="help-text d-block">Actualiza precios automáticamente desde proveedores</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="proveedores_actualizacion_stock" 
                               {% if proveedores_config.get('actualizacion_stock_automatica', False) %}checked{% endif %}>
                        <label><strong>Actualización de Stock desde Proveedores</strong></label>
                    </div>
                </div>
            </div>

            <!-- CALENDARIO -->
            <div id="tab-calendario" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-calendar-alt me-2"></i>Gestión de Calendario y Agenda</h3>
                    <p class="text-muted mb-4">Configure horarios, días laborables, citas y recordatorios del sistema</p>
                    
                    <div class="alert alert-info mb-4" style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem;">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Calendario Inteligente:</strong> Configure horarios de atención, días laborables, citas automáticas y recordatorios del sistema.
                    </div>
                    
                    {% set calendario = config.get('calendario', {}) %}
                    
                    <!-- HORARIOS DE ATENCIÓN -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-clock section-icon"></i> Horarios de Atención</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Hora de Inicio</label>
                                <input type="time" name="calendario_inicio" class="neo-input" 
                                       value="{{ calendario.get('horarios_atencion', {}).get('inicio', '08:00') }}">
                                <small class="help-text">Hora de inicio de operaciones diarias</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Hora de Fin</label>
                                <input type="time" name="calendario_fin" class="neo-input" 
                                       value="{{ calendario.get('horarios_atencion', {}).get('fin', '17:00') }}">
                                <small class="help-text">Hora de cierre de operaciones diarias</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="calendario_horario_extendido" 
                               {% if calendario.get('horario_extendido', False) %}checked{% endif %}>
                        <label><strong>Horario Extendido</strong></label>
                        <small class="help-text d-block">Permite horarios más allá del horario regular</small>
                    </div>
                    
                    <!-- DÍAS LABORABLES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-calendar-week section-icon"></i> Días Laborables</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label class="neo-label">Seleccione los días laborables</label>
                            <div class="neo-checkbox mb-2">
                                <input type="checkbox" name="calendario_lunes" 
                                       {% if 'lunes' in calendario.get('dias_laborables', []) %}checked{% endif %}>
                                <label>Lunes</label>
                            </div>
                            <div class="neo-checkbox mb-2">
                                <input type="checkbox" name="calendario_martes" 
                                       {% if 'martes' in calendario.get('dias_laborables', []) %}checked{% endif %}>
                                <label>Martes</label>
                            </div>
                            <div class="neo-checkbox mb-2">
                                <input type="checkbox" name="calendario_miercoles" 
                                       {% if 'miercoles' in calendario.get('dias_laborables', []) %}checked{% endif %}>
                                <label>Miércoles</label>
                            </div>
                            <div class="neo-checkbox mb-2">
                                <input type="checkbox" name="calendario_jueves" 
                                       {% if 'jueves' in calendario.get('dias_laborables', []) %}checked{% endif %}>
                                <label>Jueves</label>
                            </div>
                            <div class="neo-checkbox mb-2">
                                <input type="checkbox" name="calendario_viernes" 
                                       {% if 'viernes' in calendario.get('dias_laborables', []) %}checked{% endif %}>
                                <label>Viernes</label>
                            </div>
                            <div class="neo-checkbox mb-2">
                                <input type="checkbox" name="calendario_sabado" 
                                       {% if 'sabado' in calendario.get('dias_laborables', []) %}checked{% endif %}>
                                <label>Sábado</label>
                            </div>
                            <div class="neo-checkbox mb-2">
                                <input type="checkbox" name="calendario_domingo" 
                                       {% if 'domingo' in calendario.get('dias_laborables', []) %}checked{% endif %}>
                                <label>Domingo</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AGENDA Y CITAS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-calendar-check section-icon"></i> Agenda y Citas</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="calendario_agenda_habilitada" 
                               {% if calendario.get('agenda_habilitada', False) %}checked{% endif %}>
                        <label><strong>Habilitar Agenda de Citas</strong></label>
                        <small class="help-text d-block">Activa el sistema de gestión de citas</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="calendario_citas_automaticas" 
                               {% if calendario.get('citas_automaticas', True) %}checked{% endif %}>
                        <label><strong>Citas Automáticas para Servicios</strong></label>
                        <small class="help-text d-block">Genera citas automáticamente al crear órdenes de servicio</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Duración de Cita (minutos)</label>
                                <input type="number" name="calendario_duracion_cita" class="neo-input" 
                                       value="{{ calendario.get('duracion_cita', 30) }}" min="15" max="180" step="15">
                                <small class="help-text">Tiempo por defecto de cada cita</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Intervalo entre Citas (minutos)</label>
                                <input type="number" name="calendario_intervalo_citas" class="neo-input" 
                                       value="{{ calendario.get('intervalo_citas', 15) }}" min="5" max="60" step="5">
                                <small class="help-text">Tiempo de preparación entre citas</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RECORDATORIOS -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-bell section-icon"></i> Recordatorios y Notificaciones</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="calendario_recordatorios_citas" 
                               {% if calendario.get('recordatorios_citas', True) %}checked{% endif %}>
                        <label><strong>Enviar Recordatorios de Citas</strong></label>
                        <small class="help-text d-block">Notifica a clientes antes de su cita</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Tiempo de Recordatorio (horas antes)</label>
                                <input type="number" name="calendario_recordatorio_horas" class="neo-input" 
                                       value="{{ calendario.get('recordatorio_horas', 24) }}" min="1" max="168">
                                <small class="help-text">Con cuánta anticipación enviar recordatorios</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Medio de Recordatorio</label>
                                <select name="calendario_medio_recordatorio" class="neo-input">
                                    <option value="email" {% if calendario.get('medio_recordatorio', 'email') == 'email' %}selected{% endif %}>Email</option>
                                    <option value="whatsapp" {% if calendario.get('medio_recordatorio') == 'whatsapp' %}selected{% endif %}>WhatsApp</option>
                                    <option value="sms" {% if calendario.get('medio_recordatorio') == 'sms' %}selected{% endif %}>SMS</option>
                                    <option value="todos" {% if calendario.get('medio_recordatorio') == 'todos' %}selected{% endif %}>Todos los Medios</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- FESTIVOS Y VACACIONES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-calendar-times section-icon"></i> Festivos y Vacaciones</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Días Festivos (separados por comas)</label>
                        <textarea name="calendario_festivos" class="neo-input" rows="3" 
                                  placeholder="YYYY-MM-DD, YYYY-MM-DD, ...">{{ calendario.get('festivos', [])|join(', ') }}</textarea>
                        <small class="help-text">Formato: YYYY-MM-DD (ejemplo: 2025-12-25, 2025-01-01)</small>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="calendario_vacaciones_habilitadas" 
                               {% if calendario.get('vacaciones_habilitadas', False) %}checked{% endif %}>
                        <label><strong>Habilitar Período de Vacaciones</strong></label>
                        <small class="help-text d-block">Permite programar períodos de cierre</small>
                    </div>
                    
                    <!-- HORARIOS ESPECIALES -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-calendar-day section-icon"></i> Horarios Especiales</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="calendario_horarios_especiales" 
                               {% if calendario.get('horarios_especiales', False) %}checked{% endif %}>
                        <label><strong>Permitir Horarios Especiales</strong></label>
                        <small class="help-text d-block">Permite configurar horarios diferentes por día</small>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Hora Almuerzo Inicio</label>
                                <input type="time" name="calendario_hora_almuerzo_inicio" class="neo-input" 
                                       value="{{ calendario.get('hora_almuerzo_inicio', '12:00') }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Hora Almuerzo Fin</label>
                                <input type="time" name="calendario_hora_almuerzo_fin" class="neo-input" 
                                       value="{{ calendario.get('hora_almuerzo_fin', '13:00') }}">
                            </div>
                        </div>
                    </div>
                    
                    <!-- CAPACIDAD Y CONCURRENCIA -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-users section-icon"></i> Capacidad y Concurrencia</h5>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Citas Máximas por Día</label>
                                <input type="number" name="calendario_max_citas_dia" class="neo-input" 
                                       value="{{ calendario.get('max_citas_dia', 10) }}" min="1" max="50">
                                <small class="help-text">Número máximo de citas programadas por día</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="neo-form-group">
                                <label class="neo-label">Técnicos Simultáneos</label>
                                <input type="number" name="calendario_tecnicos_simultaneos" class="neo-input" 
                                       value="{{ calendario.get('tecnicos_simultaneos', 2) }}" min="1" max="10">
                                <small class="help-text">Número de técnicos trabajando simultáneamente</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SINCRONIZACIÓN -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-sync section-icon"></i> Sincronización</h5>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="calendario_sincronizacion_google" 
                               {% if calendario.get('sincronizacion_google', False) %}checked{% endif %}>
                        <label><strong>Sincronización con Google Calendar</strong></label>
                        <small class="help-text d-block">Sincroniza citas con Google Calendar</small>
                    </div>
                    
                    <div class="neo-checkbox mb-2">
                        <input type="checkbox" name="calendario_sincronizacion_outlook" 
                               {% if calendario.get('sincronizacion_outlook', False) %}checked{% endif %}>
                        <label><strong>Sincronización con Outlook</strong></label>
                    </div>
                    
                    <div class="neo-checkbox mb-3">
                        <input type="checkbox" name="calendario_exportar_calendario" 
                               {% if calendario.get('exportar_calendario', False) %}checked{% endif %}>
                        <label><strong>Exportar Calendario (.ics)</strong></label>
                        <small class="help-text d-block">Permite exportar calendario en formato estándar</small>
                    </div>
                    
                    <!-- ZONA HORARIA -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-globe section-icon"></i> Zona Horaria</h5>
                    
                    <div class="neo-form-group mb-3">
                        <label class="neo-label">Zona Horaria</label>
                        <select name="calendario_zona_horaria" class="neo-input">
                            <option value="America/Caracas" {% if calendario.get('zona_horaria', 'America/Caracas') == 'America/Caracas' %}selected{% endif %}>America/Caracas (Venezuela)</option>
                            <option value="America/Mexico_City" {% if calendario.get('zona_horaria') == 'America/Mexico_City' %}selected{% endif %}>America/Mexico_City (México)</option>
                            <option value="America/Bogota" {% if calendario.get('zona_horaria') == 'America/Bogota' %}selected{% endif %}>America/Bogota (Colombia)</option>
                            <option value="America/Buenos_Aires" {% if calendario.get('zona_horaria') == 'America/Buenos_Aires' %}selected{% endif %}>America/Buenos_Aires (Argentina)</option>
                            <option value="America/Santiago" {% if calendario.get('zona_horaria') == 'America/Santiago' %}selected{% endif %}>America/Santiago (Chile)</option>
                            <option value="America/Lima" {% if calendario.get('zona_horaria') == 'America/Lima' %}selected{% endif %}>America/Lima (Perú)</option>
                        </select>
                        <small class="help-text">Zona horaria para las citas y recordatorios</small>
                    </div>
                </div>
            </div>

            <!-- CONTADORES -->
            <div id="tab-contadores" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-hashtag me-2"></i>Contadores de Documentos</h3>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('contadores', {}).get('reset_anual', True) %}checked{% endif %}><label>Reset Anual</label></div>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('contadores', {}).get('prefijo_ano', True) %}checked{% endif %}><label>Prefijo de Año</label></div>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('contadores', {}).get('validacion_secuencial', True) %}checked{% endif %}><label>Validación Secuencial</label></div>
                </div>
            </div>

            <!-- REPORTES -->
            <div id="tab-reportes" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-chart-bar me-2"></i>Reportes</h3>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('reportes', {}).get('habilitados', True) %}checked{% endif %}><label>Habilitar Reportes</label></div>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('reportes', {}).get('exportacion_excel', True) %}checked{% endif %}><label>Exportar a Excel</label></div>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('reportes', {}).get('exportacion_pdf', True) %}checked{% endif %}><label>Exportar a PDF</label></div>
                </div>
            </div>

            <!-- INTEGRACIONES -->
            <div id="tab-integraciones" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-plug me-2"></i>Integraciones</h3>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('integraciones', {}).get('api_externas', False) %}checked{% endif %}><label>APIs Externas</label></div>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('integraciones', {}).get('sincronizacion_nube', False) %}checked{% endif %}><label>Sincronización con Nube</label></div>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('integraciones', {}).get('webhooks', False) %}checked{% endif %}><label>Webhooks</label></div>
                </div>
            </div>

            <!-- USUARIOS -->
            <div id="tab-usuarios" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-users me-2"></i>Permisos de Usuarios</h3>
                    <div class="neo-form-group">
                        <label class="neo-label">Permiso Eliminar Órdenes</label>
                        <select name="permiso_eliminar_ordenes" class="neo-input">
                            <option value="admin" {% if config.get('usuarios', {}).get('permiso_eliminar_ordenes', 'admin') == 'admin' %}selected{% endif %}>Admin</option>
                            <option value="manager">Manager</option>
                        </select>
                    </div>
                    <div class="neo-form-group">
                        <label class="neo-label">Permiso Ver Reportes</label>
                        <select name="permiso_ver_reportes" class="neo-input">
                            <option value="admin">Admin</option>
                            <option value="all">Todos</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- BACKUP -->
            <div id="tab-backup" class="config-tab-content">
                <div class="neo-card-config">
                    <h3><i class="fas fa-cloud-download-alt me-2"></i>Backup</h3>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('backup', {}).get('automatico', False) %}checked{% endif %}><label>Backup Automático</label></div>
                    <div class="neo-form-group">
                        <label class="neo-label">Intervalo (horas)</label>
                        <input type="number" name="backup_intervalo" class="neo-input" value="{{ config.get('backup', {}).get('intervalo_horas', 24) }}">
                    </div>
                    <div class="neo-checkbox"><input type="checkbox" {% if config.get('backup', {}).get('compresion', True) %}checked{% endif %}><label>Comprimir Backups</label></div>
                </div>
            </div>

            <!-- Botón de Guardar -->
            <div class="text-center">
                <button type="submit" class="btn-save">
                    <i class="fas fa-save me-2"></i>Guardar Configuración
                </button>
            </div>
        </form>
    </div>
</div>

<script>
let currentTab = 'empresa';

function mostrarTab(tabName) {
    console.log('Mostrando tab:', tabName);
    
    // Actualizar variable global
    currentTab = tabName;
    
    // Ocultar todos los contenidos
    document.querySelectorAll('.config-tab-content').forEach(tab => {
        tab.classList.remove('active');
        tab.style.display = 'none';
    });
    
    // Desactivar todas las pestañas
    document.querySelectorAll('.config-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Activar el contenido seleccionado
    const contentTab = document.getElementById(`tab-${tabName}`);
    if (!contentTab) {
        console.error('No se encontró el tab:', tabName);
        return;
    }
    
    contentTab.classList.add('active');
    contentTab.style.display = 'block';
    
    // Activar la pestaña seleccionada (si existe event)
    if (typeof event !== 'undefined' && event.target) {
        event.target.classList.add('active');
    }
    
    // Scroll suave al contenido
    setTimeout(() => {
        if (contentTab) {
            contentTab.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }, 100);
}

function filtrarTabs(searchText) {
    const tabs = document.querySelectorAll('.config-tab');
    const searchLower = searchText.toLowerCase();
    
    let foundCount = 0;
    
    tabs.forEach(tab => {
        const text = tab.textContent.toLowerCase();
        if (text.includes(searchLower) || searchText === '') {
            tab.style.display = 'flex';
            foundCount++;
        } else {
            tab.style.display = 'none';
        }
    });
    
    // Si hay coincidencia única, mostrar esa sección automáticamente
    if (foundCount === 1 && searchText !== '') {
        const visibleTab = Array.from(tabs).find(t => t.style.display !== 'none');
        if (visibleTab) {
            const tabName = visibleTab.getAttribute('onclick').match(/'(\w+)'/)[1];
            mostrarTab(tabName);
        }
    }
}

// Función para generar y enviar reportes
function generarYEnviarReporte(tipo) {
    const btn = event.target.closest('button');
    const textoOriginal = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Generando...';
    btn.disabled = true;
    
    fetch(`/api/generar-reporte-${tipo}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Mostrar modal con el enlace de WhatsApp
            mostrarModalReporte(data.mensaje, tipo);
            btn.innerHTML = '<i class="fas fa-check me-1"></i> Listo';
            setTimeout(() => {
                btn.innerHTML = textoOriginal;
                btn.disabled = false;
            }, 2000);
        } else {
            alert('Error generando reporte: ' + (data.error || 'Error desconocido'));
            btn.innerHTML = textoOriginal;
            btn.disabled = false;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error al generar el reporte');
        btn.innerHTML = textoOriginal;
        btn.disabled = false;
    });
}

function mostrarModalReporte(mensaje, tipo) {
    // Crear modal dinámico
    const modalHTML = `
        <div class="modal fade" id="modalReporte" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-check-circle me-2"></i>Reporte ${tipo.toUpperCase()} Generado
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fab fa-whatsapp me-2"></i>
                            <strong>Mensaje Listo para Enviar:</strong>
                            <pre style="background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; overflow-x: auto;">${mensaje.trim()}</pre>
                        </div>
                        <div class="text-center mt-4">
                            <p class="text-muted mb-3">
                                Para enviar por WhatsApp, usa uno de estos métodos:
                            </p>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-outline-primary w-100" onclick="abrirWhatsAppWeb('${mensaje.trim()}')">
                                        <i class="fab fa-whatsapp me-2"></i>Abrir WhatsApp Web
                                    </button>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-outline-success w-100" onclick="copiarMensaje('${mensaje.trim().replace(/'/g, "\\'")}')">
                                        <i class="fas fa-copy me-2"></i>Copiar Mensaje
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remover modal anterior si existe
    const modalExistente = document.getElementById('modalReporte');
    if (modalExistente) {
        modalExistente.remove();
    }
    
    // Agregar modal al DOM
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Mostrar modal
    const modal = new bootstrap.Modal(document.getElementById('modalReporte'));
    modal.show();
    
    // Limpiar al cerrar
    document.getElementById('modalReporte').addEventListener('hidden.bs.modal', function() {
        this.remove();
    });
}

function abrirWhatsAppWeb(mensaje) {
    // Obtener número de WhatsApp de la empresa
    fetch('/api/configuracion')
        .then(response => response.json())
        .then(config => {
            const whatsapp = config.empresa?.whatsapp || '';
            if (whatsapp) {
                let telefono = whatsapp.replace(/\D/g, ''); // Solo números
                if (!telefono.startsWith('58')) {
                    telefono = '58' + telefono;
                }
                
                const mensajeCodificado = encodeURIComponent(mensaje);
                const enlace = `https://wa.me/${telefono}?text=${mensajeCodificado}`;
                
                window.open(enlace, '_blank');
            } else {
                alert('⚠️ Debe configurar un número de WhatsApp en la sección "Empresa"');
            }
        });
}

function copiarMensaje(mensaje) {
    navigator.clipboard.writeText(mensaje).then(() => {
        alert('✅ Mensaje copiado al portapapeles');
    }).catch(() => {
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = mensaje;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('✅ Mensaje copiado al portapapeles');
    });
}

// Inicializar todo al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM cargado, inicializando configuración...');
    
    // Cargar email configurado para alertas
    fetch('/api/configuracion')
        .then(response => response.json())
        .then(config => {
            const emailConfig = document.getElementById('emailConfig');
            if (emailConfig) {
                const email = config.empresa?.email || 'No configurado';
                const whatsapp = config.empresa?.whatsapp || 'No configurado';
                emailConfig.innerHTML = email !== 'No configurado' ? `<strong>${email}</strong>` : `<em style="color: #dc3545;">⚠️ Debe configurar un email en la sección "Empresa"</em>`;
                if (email !== 'No configurado') {
                    emailConfig.style.color = '#28a745';
                }
            }
        })
        .catch(error => {
            console.error('Error cargando configuración:', error);
            const emailConfig = document.getElementById('emailConfig');
            if (emailConfig) {
                emailConfig.innerHTML = '<em style="color: #dc3545;">Error cargando</em>';
            }
        });
    
    // Restaurar tab activo DESPUÉS de que todo esté cargado
    setTimeout(() => {
        try {
            const activeTab = localStorage.getItem('activeConfigTab') || 'empresa';
            console.log('Restaurando tab activo:', activeTab);
            mostrarTab(activeTab);
        } catch (e) {
            console.error('Error restaurando tab:', e);
            // Si falla, mostrar el tab empresa por defecto
            setTimeout(() => mostrarTab('empresa'), 100);
        }
    }, 100);
    
    // Guardar tab activo antes de cambiar
    document.querySelectorAll('.config-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            try {
                const tabName = this.getAttribute('onclick').match(/'(\w+)'/)[1];
                localStorage.setItem('activeConfigTab', tabName);
                console.log('Guardado tab:', tabName);
            } catch (e) {
                console.error('Error guardando tab:', e);
            }
        });
    });
    
    // Manejar el envío del formulario - SIMPLIFICADO
    const form = document.querySelector('form[action="/configuracion"]');
    if (form) {
        console.log('✅ Formulario encontrado, agregando listener submit');
        form.addEventListener('submit', function(e) {
            console.log('🚀 FORMULARIO SIENDO ENVIADO...');
            console.log('📋 Campos del formulario:', Object.keys(this.elements).length);
            
            // Capturar tags de tipos de clientes
            const tiposClientesContainer = document.getElementById('tiposClientesContainer');
            const tiposClientes = [];
            if (tiposClientesContainer) {
                tiposClientesContainer.querySelectorAll('.custom-tag').forEach(tag => {
                    const nombre = tag.querySelector('.tag-name').value.trim();
                    const color = tag.style.background || '#007bff';
                    const icono = tag.querySelector('.tag-icon i').className;
                    if (nombre) {
                        tiposClientes.push({ nombre, color, icono });
                    }
                });
            }
            
            // Capturar tags de prioridades
            const prioridadesContainer = document.getElementById('prioridadesContainer');
            const prioridades = [];
            if (prioridadesContainer) {
                prioridadesContainer.querySelectorAll('.custom-tag').forEach(tag => {
                    const nombre = tag.querySelector('.tag-name').value.trim();
                    const color = tag.style.background || '#ffc107';
                    const icono = tag.querySelector('.tag-icon i').className;
                    if (nombre) {
                        prioridades.push({ nombre, color, icono });
                    }
                });
            }
            
            // Agregar datos de categorías como campo hidden
            const categoriasData = JSON.stringify({
                tipos_clientes: tiposClientes,
                prioridades: prioridades
            });
            
            // Eliminar campo anterior si existe
            const campoAnterior = document.getElementById('categorias_data');
            if (campoAnterior) {
                campoAnterior.remove();
            }
            
            // Crear nuevo campo hidden
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'categorias_data';
            hiddenInput.id = 'categorias_data';
            hiddenInput.value = categoriasData;
            this.appendChild(hiddenInput);
            
            console.log('📦 Datos de categorías enviados:', categoriasData);
            
            const btn = document.querySelector('.btn-save');
            if (btn) {
                btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Guardando...';
                btn.disabled = true;
            }
            // NO prevenir el envío - permitir POST normal
        });
    } else {
        console.error('❌ No se encontró el formulario');
    }
    
    // Detectar si viene de un redirect exitoso y mostrar alerta
    const urlParams = new URLSearchParams(window.location.search);
    const flash = urlParams.get('success');
    
    // Verificar si hay mensaje flash en la página
    setTimeout(() => {
        const flashMessage = document.querySelector('.alert-success, .flash-message');
        if (flashMessage || urlParams.get('config_saved')) {
            console.log('✅ CONFIGURACIÓN GUARDADA CON ÉXITO!');
            console.log('🎉 Todos los cambios han sido aplicados correctamente');
            
            // Mostrar alerta visual
            const alertDiv = document.getElementById('successAlert');
            if (alertDiv) {
                alertDiv.classList.remove('d-none');
                alertDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Ocultar después de 5 segundos
                setTimeout(() => {
                    alertDiv.classList.add('d-none');
                }, 5000);
            }
            
            // Limpiar URL
            if (urlParams.get('config_saved')) {
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }
    }, 500);
});

// Agregar ayuda contextual
document.querySelectorAll('.neo-label').forEach(label => {
    const originalText = label.textContent;
    label.title = originalText;
});

// Función para previsualizar el logo
function previewLogo(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const preview = document.getElementById('logoPreview');
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        
        reader.readAsDataURL(input.files[0]);
    }
}

// Cargar tasa actual al abrir la pestaña de tasas
function cargarTasaActual() {
    fetch('/api/tasa-bcv')
        .then(response => response.json())
        .then(data => {
            console.log('Respuesta API tasa-bcv:', data);
            const tasaIng = document.getElementById('tasaActual');
            if (tasaIng) {
                if (data.tasa) {
                    let advertencia = '';
                    if (data.advertencia) {
                        advertencia = ' <small style="color: #ff9800;">(No del BCV)</small>';
                    }
                    tasaIng.innerHTML = `<strong style="color: #4f46e5;">${data.tasa}</strong> Bs. x USD${advertencia}`;
                } else if (data.error) {
                    tasaIng.textContent = `Error: ${data.error}`;
                } else {
                    tasaIng.textContent = 'No disponible';
                }
            }
        })
        .catch(error => {
            console.error('Error cargando tasa:', error);
            const tasaIng = document.getElementById('tasaActual');
            if (tasaIng) {
                tasaIng.textContent = 'Error al cargar';
            }
        });
}

// Función para actualizar tasa manualmente
function actualizarTasaManual() {
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Actualizando...';
    btn.disabled = true;
    
    fetch('/api/tasas-actualizadas')
        .then(response => response.json())
        .then(data => {
            console.log('Respuesta actualización tasas:', data);
            if (data.success) {
                // Actualizar tasas en la página
                if (document.getElementById('tasaUsdActual')) {
                    document.getElementById('tasaUsdActual').textContent = data.tasa_bcv.toFixed(2);
                }
                if (document.getElementById('tasaEurActual')) {
                    document.getElementById('tasaEurActual').textContent = data.tasa_bcv_eur.toFixed(2);
                }
                
                btn.innerHTML = '<i class="fas fa-check"></i> Actualizado';
                btn.classList.add('btn-success');
                btn.classList.remove('btn-primary');
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-primary');
                    btn.disabled = false;
                    // Recargar página después de un momento para mostrar nueva actualización
                    location.reload();
                }, 1000);
            } else {
                btn.innerHTML = '<i class="fas fa-times"></i> Error';
                btn.classList.add('btn-danger');
                btn.classList.remove('btn-primary');
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.classList.remove('btn-danger');
                    btn.classList.add('btn-primary');
                    btn.disabled = false;
                }, 2000);
            }
        })
        .catch(error => {
            console.error('Error actualizando tasas:', error);
            btn.innerHTML = '<i class="fas fa-times"></i> Error';
            btn.classList.add('btn-danger');
            btn.classList.remove('btn-primary');
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-primary');
            }, 2000);
        });
}

// Detectar cuando se abre la pestaña de tasas
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.config-tab');
    
    // Verificar si la pestaña de tasas está activa al cargar
    const tabTasas = Array.from(tabs).find(tab => tab.getAttribute('onclick').includes('tasas'));
    if (tabTasas && tabTasas.classList.contains('active')) {
        // Si ya está activa, cargar la tasa inmediatamente
        setTimeout(cargarTasaActual, 100);
    }
    
    // Agregar listeners para cuando se hace clic en una pestaña
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            if (this.getAttribute('onclick').includes('tasas')) {
                setTimeout(cargarTasaActual, 300);
            }
        });
    });
});
</script>
{% endblock %}


